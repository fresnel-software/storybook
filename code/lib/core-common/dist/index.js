"use strict";var Xe=Object.create;var C=Object.defineProperty;var Ze=Object.getOwnPropertyDescriptor;var Qe=Object.getOwnPropertyNames;var er=Object.getPrototypeOf,rr=Object.prototype.hasOwnProperty;var tr=(e,r)=>{for(var t in r)C(e,t,{get:r[t],enumerable:!0})},oe=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Qe(r))!rr.call(e,n)&&n!==t&&C(e,n,{get:()=>r[n],enumerable:!(o=Ze(r,n))||o.enumerable});return e};var f=(e,r,t)=>(t=e!=null?Xe(er(e)):{},oe(r||!e||!e.__esModule?C(t,"default",{value:e,enumerable:!0}):t,e)),or=e=>oe(C({},"__esModule",{value:!0}),e);var Hr={};tr(Hr,{boost:()=>E,cache:()=>Fr,checkAddonOrder:()=>mr,createFileSystemCache:()=>D,filterPresetsConfig:()=>ge,findDistEsm:()=>qr,getAutoRefs:()=>Se,getDirectoryFromWorkingDir:()=>We,getFrameworkName:()=>vr,getInterpretedFile:()=>u,getInterpretedFileWithExt:()=>J,getPresets:()=>be,getPreviewBodyTemplate:()=>Nr,getPreviewHeadTemplate:()=>Tr,getPreviewMainTemplate:()=>Dr,getProjectRoot:()=>lr,getRefs:()=>$r,getStorybookConfiguration:()=>V,getStorybookInfo:()=>Rr,globToRegexp:()=>ee,handlebars:()=>br,interopRequireDefault:()=>$,interpolate:()=>Lr,isPreservingSymlinks:()=>zr,loadAllPresets:()=>pr,loadCustomPresets:()=>q,loadEnvs:()=>ur,loadMainConfig:()=>xr,loadManagerOrAddonsFile:()=>jr,loadPreset:()=>ye,loadPreviewOrConfigFile:()=>Sr,logConfig:()=>Ar,nodePathsToArray:()=>W,normalizeStories:()=>Jr,normalizeStoriesEntry:()=>Ge,normalizeStoryPath:()=>G,readTemplate:()=>Ur,resolveAddonName:()=>ue,resolvePathInStorybookCache:()=>Z,serverRequire:()=>h,serverResolve:()=>j,stringifyEnvs:()=>yr,stringifyProcessEnvs:()=>hr,useProgressReporting:()=>Ir,validateConfigurationFiles:()=>w});module.exports=or(Hr);var me=require("ts-dedent"),x=require("@storybook/node-logger"),le=require("path");var S=f(require("path"));var B=f(require("fs")),E=new Set([".js",".jsx",".ts",".tsx",".cjs",".mjs"]);function nr(){return[...Array.from(E)]}var ne=nr();function u(e){return ne.map(r=>e.endsWith(r)?e:`${e}${r}`).find(r=>B.default.existsSync(r))}function J(e){return ne.map(r=>({path:e.endsWith(r)?e:`${e}${r}`,ext:r})).find(r=>B.default.existsSync(r.path))}var se=!1;function $(e){if(se===!1){let{register:o}=require("esbuild-register/dist/node");se=!0,o({target:`node${process.version.slice(1)}`,format:"cjs",hookIgnoreNodeModules:!1,tsconfigRaw:`{
      "compilerOptions": {
        "strict": false,
        "skipLibCheck": true,
      },
    }`})}let r=require(e);return typeof r=="object"&&r!==null&&typeof r.default<"u"?r.default:r}function sr(e){for(let r=0;r<e.length;r+=1){let t=J(e[r]);if(t)return t}}function h(e){let r=j(e);return r?$(r):null}function j(e){let r=Array.isArray(e)?e:[e],t=sr(r);return t?t.path:null}var P=require("ts-dedent"),ie=f(require("util-deprecate")),ae=f(require("glob")),b=f(require("path"));var ir=(0,ie.default)(()=>{},P.dedent`
    Configuration files such as "config", "presets" and "addons" are deprecated and will be removed in Storybook 7.0.
    Read more about it in the migration guide: https://github.com/storybookjs/storybook/blob/master/MIGRATION.md#to-mainjs-configuration
  `),U=(e,r,t)=>{let o=b.default.resolve(t,e),n=b.default.resolve(t,r);throw new Error(P.dedent`
    You have mixing configuration files:
    ${o}
    ${n}
    "${e}" and "${r}" cannot coexist.
    Please check the documentation for migration steps: https://github.com/storybookjs/storybook/blob/master/MIGRATION.md#to-mainjs-configuration
  `)};function w(e){let r=`{${Array.from(E).join(",")}}`,t=i=>!!ae.default.sync(b.default.resolve(e,`${i}${r}`)).length,o=t("main"),n=t("config");if(!o&&!n)throw new Error(P.dedent`
      No configuration files have been found in your configDir (${b.default.resolve(e)}).
      Storybook needs either a "main" or "config" file.
    `);if(o&&n)throw new Error(P.dedent`
      You have both a "main" and a "config". Please remove the "config" file from your configDir (${b.default.resolve(e,"config")})`);let s=t("presets");o&&s&&U("main","presets",e),t("preview")&&n&&U("preview","config",e);let a=t("addons");t("manager")&&a&&U("manager","addons",e),(s||n||a)&&ir()}function q({configDir:e}){w(e);let r=h(S.default.resolve(e,"presets"));if(h(S.default.resolve(e,"main"))){let o=j(S.default.resolve(e,"main"));if(o)return[o]}return r||[]}var ce=f(require("resolve-from")),fe=(e,r)=>{try{return(0,ce.default)(e,r)}catch{return}},pe=e=>{try{return require.resolve(e)}catch{return}};var k=e=>e!=null&&typeof e=="object"&&Array.isArray(e)===!1,ar=e=>typeof e=="function";function ge(e){return e.filter(r=>{let t=typeof r=="string"?r:r.name;return!/@storybook[\\\\/]preset-typescript/.test(t)})}function de(e,r,t){return ar(e)?[...e({...t,...r})]:Array.isArray(e)?[...e]:[]}var ue=(e,r,t)=>{let o=r.startsWith("/")?pe:fe.bind(null,e),n=o(r);if(n){if(r.match(/\/(manager|register(-panel)?)(\.(js|ts|tsx|jsx))?$/))return{type:"virtual",name:r,managerEntries:[n]};if(r.match(/\/(preset)(\.(js|ts|tsx|jsx))?$/))return{type:"presets",name:n}}let s=n&&o(`${r}/package.json`),p=s&&(0,le.dirname)(s),a=g=>{if(o(`${r}${g}`))return`${p}${g}`},d=r,i=a("/manager"),c=a("/register")||a("/register-panel"),m=a("/preview"),l=o(`${d}/preset`);if(!(i||m)&&l)return{type:"presets",name:l};if(i||c||m||l){let g=[];return i&&g.push(i),!i&&c&&!l&&g.push(c),{type:"virtual",name:d,...g.length?{managerEntries:g}:{},...m?{previewAnnotations:[m]}:{},...l?{presets:[{name:l,options:t}]}:{}}}if(n)return{type:"presets",name:n}},cr=({configDir:e})=>r=>{let t=k(r)&&r.options||void 0,o=k(r)?r.name:r;try{let n=ue(e,o,t);return{...t?{options:t}:{},...n}}catch{x.logger.error(`Addon value should end in /manager or /preview or /register OR it should be a valid preset https://storybook.js.org/docs/react/addons/writing-presets/
${r}`)}};async function fr(e){if(e.type==="virtual"){let{type:t,name:o,...n}=e;return n}let r=e.name?e.name:e;return $(r)}async function ye(e,r,t){try{let o=e.name?e.name:e,n=e.options?e.options:{},s=await fr(e);if(typeof s=="function"&&(s=s(t,n)),Array.isArray(s))return A(s,r+1,t);if(k(s)){let{addons:p,presets:a,...d}=s,i=de(a,n,t),c=de(p,n,t);return[...await A([...i],r+1,t),...await A([...c.map(cr(t))].filter(Boolean),r+1,t),{name:o,preset:d,options:n}]}throw new Error(me.dedent`
      ${e} is not a valid preset
    `)}catch(o){let n=r>0?`  Failed to load preset: ${JSON.stringify(e)} on level ${r}`:`  Failed to load preset: ${JSON.stringify(e)}`;return x.logger.warn(n),x.logger.error(o),[]}}async function A(e,r,t){return!e||!Array.isArray(e)||!e.length?[]:(r||x.logger.info("=> Loading presets"),(await Promise.all(e.map(async o=>ye(o,r,t)))).reduce((o,n)=>o.concat(n),[]))}function he(e,r,t,o,n){let s=new Promise(p=>p(t));return e.length?e.reduce((p,{preset:a,options:d})=>{let i=a[r];if(!i)return p;if(typeof i=="function"){let c=i,m={preset:a,combinedOptions:{...n,...o,...d,presetsList:e,presets:{apply:async(l,g,R={})=>he(e,l,g,R,n)}}};return p.then(l=>c.call(m.preset,l,m.combinedOptions))}return p.then(c=>Array.isArray(c)&&Array.isArray(i)?[...c,...i]:k(c)&&k(i)?{...c,...i}:i)},s):s}async function be(e,r){let t=await A(e,0,r);return{apply:async(o,n,s={})=>he(t,o,n,s,r)}}async function pr(e){let{corePresets:r=[],overridePresets:t=[],...o}=e,n=[...r,...q(e),...t],s=ge(n);return s.length<n.length&&x.logger.warn("Storybook now supports TypeScript natively. You can safely remove `@storybook/preset-typescript`."),be(s,o)}var{logger:z}=require("@storybook/node-logger"),H=e=>r=>{let t=r.name||r;return t&&t.includes(e)},dr=(e,r,t)=>{let o=e.findIndex(H("@storybook/addon-essentials")),n=e.findIndex(H(r.name)),s=e.findIndex(H(t.name));return n===-1&&r.inEssentials&&(n=o),s===-1&&t.inEssentials&&(s=o),n!==-1&&s!==-1&&n<=s},mr=async({before:e,after:r,configFile:t,getConfig:o})=>{try{let n=await o(t);if(!(n!=null&&n.addons)){z.warn("Unable to find 'addons' config in main Storybook config");return}if(!dr(n.addons,e,r)){let s=" (or '@storybook/addon-essentials')",p=`'${e.name}'${e.inEssentials?s:""}`,a=`'${r.name}'${r.inEssentials?s:""}`;z.warn(`Expected ${p} to be listed before ${a} in main Storybook config.`)}}catch{z.warn(`Unable to load config file: ${t}`)}};var xe=require("lazy-universal-dotenv");var O=f(require("path")),Y=f(require("find-up")),lr=()=>{let e;try{let r=Y.default.sync(".git",{type:"directory"});r&&(e=e||O.default.join(r,".."))}catch{}try{let r=Y.default.sync(".svn",{type:"directory"});r&&(e=e||O.default.join(r,".."))}catch{}try{e=e||__dirname.split("node_modules")[0]}catch{}return e||process.cwd()},W=e=>e.split(process.platform==="win32"?";":":").filter(Boolean).map(r=>O.default.resolve("./",r)),gr=/^\.{1,2}([/\\]|$)/;function G(e){return gr.test(e)?e:`.${O.default.sep}${e}`}function ur(e={}){let r=e.production?"production":"development",t={NODE_ENV:process.env.NODE_ENV||r,NODE_PATH:process.env.NODE_PATH||"",STORYBOOK:process.env.STORYBOOK||"true",PUBLIC_URL:e.production?".":""};Object.keys(process.env).filter(a=>/^STORYBOOK_/.test(a)).forEach(a=>{t[a]=process.env[a]});let o=Object.entries(t).reduce((a,[d,i])=>Object.assign(a,{[d]:JSON.stringify(i)}),{}),{stringified:n,raw:s}=(0,xe.getEnvironment)({nodeEnv:t.NODE_ENV}),p={...t,...s};return p.NODE_PATH=W(p.NODE_PATH||""),{stringified:{...o,...n},raw:p}}var yr=e=>Object.entries(e).reduce((r,[t,o])=>(r[t]=JSON.stringify(o),r),{}),hr=e=>Object.entries(e).reduce((t,[o,n])=>(t[`process.env.${o}`]=JSON.stringify(n),t),{"process.env.XSTORYBOOK_EXAMPLE_APP":'""'});var ve=f(require("handlebars"));function br(e,r){return ve.default.compile(e)(r)}var Pe=f(require("path"));function xr({configDir:e}){return w(e),h(Pe.default.resolve(e,"main"))}var we=require("ts-dedent");async function vr(e){let r=await e.presets.apply("framework","",e);if(!r)throw new Error(we.dedent`
      You must specify a framework in '.storybook/main.js' config.

      https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#framework-field-mandatory
    `);return typeof r=="object"?r.name:r}function V(e,r,t){if(!e)return null;let o=e.split(/[\s='"]+/),n=o.indexOf(t);return n===-1&&(n=o.indexOf(r)),n===-1?null:o[n+1]}var Re=f(require("path")),Ce=f(require("fs-extra"));var ke={"@storybook/react":"react","@storybook/vue":"vue","@storybook/vue3":"vue3","@storybook/angular":"angular","@storybook/html":"html","@storybook/web-components":"web-components","@storybook/polymer":"polymer","@storybook/ember":"ember","@storybook/marko":"marko","@storybook/mithril":"mithril","@storybook/riot":"riot","@storybook/svelte":"svelte","@storybook/preact":"preact","@storybook/rax":"rax","@storybook/server":"server"},Oe=console,Pr=({dependencies:e,devDependencies:r,peerDependencies:t},o)=>[Object.entries(e||{}).find(o),Object.entries(r||{}).find(o),Object.entries(t||{}).find(o)],wr=e=>{let[r,t,o]=Pr(e,([a])=>ke[a]),[n,s]=r||t||o||[],p=n?ke[n]:void 0;return r&&t&&r[0]===t[0]&&Oe.warn(`Found "${r[0]}" in both "dependencies" and "devDependencies". This is probably a mistake.`),r&&o&&r[0]===o[0]&&Oe.warn(`Found "${r[0]}" in both "dependencies" and "peerDependencies". This is probably a mistake.`),{version:s,framework:p,frameworkPackage:n,renderer:p,rendererPackage:n}},kr=["ts","js","tsx","jsx","mjs","cjs"],K=(e,r)=>{let t=Re.default.join(r,e),o=kr.find(n=>Ce.default.existsSync(`${t}.${n}`));return o?`${t}.${o}`:null},Or=e=>{var o;let r=".storybook",t=(o=e.scripts)==null?void 0:o.storybook;if(t){let n=V(t,"-c","--config-dir");n&&(r=n)}return{configDir:r,mainConfig:K("main",r),previewConfig:K("preview",r),managerConfig:K("manager",r)}},Rr=e=>{let r=wr(e),t=Or(e);return{...r,...t}};var X=require("fs-extra"),I=require("path"),Ee=f(require("find-up")),$e=f(require("resolve-from")),je=require("@storybook/node-logger"),Se=async e=>{let r=await(0,Ee.default)("package.json",{cwd:e.configDir});if(!r)return{};let t=(0,I.dirname)(r),{dependencies:o=[],devDependencies:n=[]}=await(0,X.readJSON)(r)||{},s=Object.keys({...o,...n});return(await Promise.all(s.map(async a=>{try{let d=(0,$e.default)(t,(0,I.join)(a,"package.json")),{storybook:i,name:c,version:m}=await(0,X.readJSON)(d)||{};if(i!=null&&i.url)return{id:c,...i,version:m}}catch{je.logger.warn(`unable to find package.json for ${a}`);return}}))).filter(Boolean).reduce((a,d)=>({...a,[d.id]:{id:d.id.toLowerCase(),url:Ae(d.url),title:d.title,version:d.version}}),{})},Cr=e=>fetch(`${e}/iframe.html`).then(async({ok:r,status:t})=>{if(r){if(t!==200)return!1;let o=await fetch(`${e}/iframe.html`,{headers:{Accept:"application/json"}});if(o.ok&&(await o.json().catch(n=>({}))).loginUrl)return!1}return r},()=>!1),Ae=e=>e.replace(/\/$/,""),Er=e=>{let r=e.replace(/[A-Z]/g,t=>` ${t}`).replace(/[-_][A-Z]/gi,t=>` ${t.toUpperCase()}`).replace(/-/g," ").replace(/_/g," ");return`${r.substring(0,1).toUpperCase()}${r.substring(1)}`.trim()};async function $r(e){let r=await e.presets.apply("refs",await Se(e));return Object.entries(r).forEach(([t,o])=>{if(o.disable){delete r[t];return}r[t.toLowerCase()]={...o,id:t.toLowerCase(),title:o.title||Er(o.id||t),url:Ae(o.url)}}),await Promise.all(Object.entries(r).map(async([t,o])=>{let n=await Cr(o.url);r[t]={...o,type:n?"server-checked":"unknown"}})),r}var F=f(require("path")),Ie=require("@storybook/node-logger"),Fe=require("ts-dedent");function jr({configDir:e}){let r=u(F.default.resolve(e,"addons")),t=u(F.default.resolve(e,"manager"));if((r||t)&&Ie.logger.info("=> Loading custom manager config"),r&&t)throw new Error(Fe.dedent`
      You have both a "addons.js" and a "manager.js", remove the "addons.js" file from your configDir (${F.default.resolve(e,"addons")})`);return t||r}var N=f(require("path")),Ne=require("ts-dedent");function Sr({configDir:e}){let r=u(N.default.resolve(e,"config")),t=u(N.default.resolve(e,"preview"));if(r&&t)throw new Error(Ne.dedent`
      You have both a "config.js" and a "preview.js", remove the "config.js" file from your configDir (${N.default.resolve(e,"config")})`);return t||r}var Te=f(require("chalk"));function Ar(e,r){console.log(Te.default.cyan(e)),console.dir(r,{depth:null})}var De=f(require("pretty-hrtime")),Le=e=>(0,De.default)(process.hrtime(e)).replace(" ms"," milliseconds").replace(" s"," seconds").replace(" m"," minutes");var Ir=async(e,r,t)=>{var d;let o=0,n,s=()=>{};e.get("/progress",(i,c)=>{let m=!1,l=()=>{m=!0,c.end()};c.on("close",l),!(m||c.writableEnded)&&(c.setHeader("Cache-Control","no-cache"),c.setHeader("Content-Type","text/event-stream"),c.setHeader("Connection","keep-alive"),c.flushHeaders(),s=g=>{m||c.writableEnded||(c.write(`data: ${JSON.stringify(g)}

`),c.flush(),g.value===1&&l())})});let p=(i,c,m)=>{o=Math.max(i,o);let l={value:o,message:c.charAt(0).toUpperCase()+c.slice(1)};if(c==="building"){let g=m&&m.match(/(\d+)\/(\d+)/)||[],R=parseInt(g[1],10),M=parseInt(g[2],10);!Number.isNaN(R)&&!Number.isNaN(M)&&(l.modules={complete:R,total:M},n=M)}o===1&&(t.cache&&t.cache.set("modulesCount",n),l.message||(l.message=`Completed in ${Le(r)}.`)),s(l)},a=await((d=t.cache)==null?void 0:d.get("modulesCount").catch(()=>{}))||1e3;return{handler:p,modulesCount:a}};var T=f(require("path")),_e=f(require("pkg-dir"));function Z(e){let r=process.cwd(),t=_e.default.sync(r),o;return t?o=T.default.resolve(t,"node_modules/.cache/storybook"):o=T.default.resolve(r,".cache/storybook"),T.default.join(o,e)}var Me=f(require("file-system-cache"));function D(e){return(0,Me.default)(e)}var Fr=D({basePath:Z("dev-server"),ns:"storybook"});var Q=f(require("path")),L=require("pkg-dir"),y=f(require("fs")),Be=(e,r={})=>Object.entries(r).reduce((t,[o,n])=>t.replace(new RegExp(`%${o}%`,"g"),n),e);function Nr(e,r){let t=y.default.readFileSync(`${(0,L.sync)(__dirname)}/templates/base-preview-body.html`,"utf8"),o=Q.default.resolve(e,"preview-body.html"),n=t;return y.default.existsSync(o)&&(n=y.default.readFileSync(o,"utf8")+n),Be(n,r)}function Tr(e,r){let t=y.default.readFileSync(`${(0,L.sync)(__dirname)}/templates/base-preview-head.html`,"utf8"),o=Q.default.resolve(e,"preview-head.html"),n=t;return y.default.existsSync(o)&&(n+=y.default.readFileSync(o,"utf8")),Be(n,r)}function Dr(){return`${(0,L.sync)(__dirname)}/templates/preview.ejs`}var Lr=(e,r)=>Object.entries(r).reduce((t,[o,n])=>{let s=n.replace(/\\/g,"/").replace(/\$/g,"$$$");return t.replace(new RegExp(`{{${o}}}`,"g"),s)},e);var Je=require("picomatch");function ee(e){let r=(0,Je.makeRe)(e,{fastpaths:!1,noglobstar:!1,bash:!1});if(!r.source.startsWith("^"))throw new Error(`Invalid glob: >> ${e} >> ${r}`);return e.startsWith("./")?new RegExp(["^\\.",e.startsWith("./**")?"":"[\\\\/]",r.source.substring(1)].join("")):r}var qe=f(require("fs")),v=f(require("path")),ze=f(require("util-deprecate")),He=require("ts-dedent"),Ye=require("picomatch"),re=f(require("slash"));var _="",Ue="**/*.@(mdx|stories.mdx|stories.tsx|stories.ts|stories.jsx|stories.js)",_r=(0,ze.default)(e=>e.input.replace(e[1],`@${e[1]}`),He.dedent`
    You have specified an invalid glob, we've attempted to fix it, please ensure that the glob you specify is valid. See: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#correct-globs-in-mainjs
  `),Mr=e=>{let r=e.match(/\.(\([^)]+\))/);return r?_r(r):e},Br=(e,r)=>{try{return qe.default.lstatSync(v.default.resolve(e,r)).isDirectory()}catch{return!1}},We=({configDir:e,workingDir:r,directory:t})=>{let o=v.default.resolve(e,t),n=v.default.relative(r,o);return G(n)},Ge=(e,{configDir:r,workingDir:t})=>{let o;if(typeof e=="string"){let d=Mr(e),i=(0,Ye.scan)(d);if(i.isGlob){let c=i.prefix+i.base,m=i.glob;o={titlePrefix:_,directory:c,files:m}}else Br(r,e)?o={titlePrefix:_,directory:e,files:Ue}:o={titlePrefix:_,directory:v.default.dirname(e),files:v.default.basename(e)}}else o={titlePrefix:_,files:Ue,...e};let n=(0,re.default)(o.files),{directory:s}=o,p=(0,re.default)(We({configDir:r,workingDir:t,directory:s})).replace(/\/$/,""),a=ee(`${p}/${n}`);return{...o,directory:p,importPathMatcher:a}},Jr=(e,r)=>e.map(t=>Ge(t,r));var Ve=f(require("fs-extra"));async function Ur(e){return Ve.default.readFile(e,{encoding:"utf8"})}var te=f(require("path")),Ke=require("find-up"),qr=(e,r)=>{let t=(0,Ke.sync)("package.json",{cwd:e});if(!t)throw new Error(`Could not find package.json in: ${e}`);let o=te.default.dirname(t);return te.default.join(o,"dist","esm",r)};function zr(){let{NODE_OPTIONS:e,NODE_PRESERVE_SYMLINKS:r}=process.env;return!!r||(e==null?void 0:e.includes("--preserve-symlinks"))}0&&(module.exports={boost,cache,checkAddonOrder,createFileSystemCache,filterPresetsConfig,findDistEsm,getAutoRefs,getDirectoryFromWorkingDir,getFrameworkName,getInterpretedFile,getInterpretedFileWithExt,getPresets,getPreviewBodyTemplate,getPreviewHeadTemplate,getPreviewMainTemplate,getProjectRoot,getRefs,getStorybookConfiguration,getStorybookInfo,globToRegexp,handlebars,interopRequireDefault,interpolate,isPreservingSymlinks,loadAllPresets,loadCustomPresets,loadEnvs,loadMainConfig,loadManagerOrAddonsFile,loadPreset,loadPreviewOrConfigFile,logConfig,nodePathsToArray,normalizeStories,normalizeStoriesEntry,normalizeStoryPath,readTemplate,resolveAddonName,resolvePathInStorybookCache,serverRequire,serverResolve,stringifyEnvs,stringifyProcessEnvs,useProgressReporting,validateConfigurationFiles});
