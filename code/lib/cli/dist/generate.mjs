var ho=Object.freeze,wo=Object.defineProperty;var U=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(o,t)=>(typeof require!="undefined"?require:o)[t]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var Ar=(e,o)=>{for(var t in o)wo(e,t,{get:o[t],enumerable:!0})};var vo=(e,o)=>ho(wo(e,"raw",{value:ho(o||e.slice())}));var p={};import b from"commander";import Ii from"path";import Ne from"chalk";import _i from"envinfo";import Vi from"leven";import{sync as Ni}from"read-pkg-up";import{logger as I}from"@storybook/node-logger";import{UpdateNotifier as us}from"update-notifier";import me from"chalk";import so from"prompts";import{telemetry as gs}from"@storybook/telemetry";import{validRange as xo,minVersion as Po}from"@storybook/semver";function he(e,o){return xo(e)&&Po(e).major<o}function So(e,o){return xo(e)&&Po(e).major===o}var Co=["react","react-native","vue","vue3","angular","mithril","riot","ember","marionette","marko","preact","svelte","rax","aurelia"],we=(y=>(y.UNDETECTED="UNDETECTED",y.UNSUPPORTED="UNSUPPORTED",y.REACT_SCRIPTS="REACT_SCRIPTS",y.REACT="REACT",y.REACT_NATIVE="REACT_NATIVE",y.REACT_PROJECT="REACT_PROJECT",y.WEBPACK_REACT="WEBPACK_REACT",y.VUE="VUE",y.VUE3="VUE3",y.SFC_VUE="SFC_VUE",y.ANGULAR="ANGULAR",y.EMBER="EMBER",y.ALREADY_HAS_STORYBOOK="ALREADY_HAS_STORYBOOK",y.WEB_COMPONENTS="WEB_COMPONENTS",y.MITHRIL="MITHRIL",y.MARIONETTE="MARIONETTE",y.MARKO="MARKO",y.HTML="HTML",y.RIOT="RIOT",y.PREACT="PREACT",y.SVELTE="SVELTE",y.RAX="RAX",y.AURELIA="AURELIA",y.SERVER="SERVER",y))(we||{});var Ro=[{preset:"SFC_VUE",dependencies:{"vue-loader":e=>he(e,16),vuetify:e=>he(e,3)},matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"VUE",dependencies:{vue:e=>he(e,3),nuxt:e=>he(e,3)},matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"VUE3",dependencies:{vue:e=>e==="next"||So(e,3)},matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"EMBER",dependencies:["ember-cli"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"REACT_PROJECT",peerDependencies:["react"],matcherFunction:({peerDependencies:e})=>e.every(Boolean)},{preset:"REACT_NATIVE",dependencies:["react-native","react-native-scripts"],matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"REACT_SCRIPTS",files:["/node_modules/.bin/react-scripts"],dependencies:["react-scripts"],matcherFunction:({dependencies:e,files:o})=>e.every(Boolean)||o.every(Boolean)},{preset:"WEBPACK_REACT",dependencies:["react","webpack"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"REACT",dependencies:["react"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"ANGULAR",dependencies:["@angular/core"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"WEB_COMPONENTS",dependencies:["lit-element","lit-html","lit"],matcherFunction:({dependencies:e})=>e.some(Boolean)},{preset:"MITHRIL",dependencies:["mithril"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"MARIONETTE",dependencies:["backbone.marionette"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"MARKO",dependencies:["marko"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"RIOT",dependencies:["riot"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"PREACT",dependencies:["preact"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"SVELTE",dependencies:["svelte"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"RAX",dependencies:["rax"],matcherFunction:({dependencies:e})=>e.every(Boolean)},{preset:"AURELIA",dependencies:["aurelia-bootstrapper"],matcherFunction:({dependencies:e})=>e.every(Boolean)}],Do={preset:"UNSUPPORTED",dependencies:{nuxt:e=>So(e,3)},matcherFunction:({dependencies:e})=>e.some(Boolean)},Or=["UNDETECTED","UNSUPPORTED","ALREADY_HAS_STORYBOOK"],ve=Object.values(we).filter(e=>!Or.includes(e)).map(e=>e.toLowerCase());import _r from"path";import Vr from"fs";import Nr from"find-up";import xe,{join as ce}from"path";import H from"fs";import W from"fs-extra";import Y from"chalk";import{satisfies as Fr}from"@storybook/semver";import Jr from"strip-json-comments";import{dirname as $r}from"path";function R(){return $r(U.resolve("@storybook/cli/package.json"))}var D={"@storybook/addon-a11y":"7.0.0-alpha.33","@storybook/addon-actions":"7.0.0-alpha.33","@storybook/addon-backgrounds":"7.0.0-alpha.33","@storybook/addon-controls":"7.0.0-alpha.33","@storybook/addon-docs":"7.0.0-alpha.33","@storybook/addon-essentials":"7.0.0-alpha.33","@storybook/addon-highlight":"7.0.0-alpha.33","@storybook/addon-interactions":"7.0.0-alpha.33","@storybook/addon-jest":"7.0.0-alpha.33","@storybook/addon-links":"7.0.0-alpha.33","@storybook/addon-measure":"7.0.0-alpha.33","@storybook/addon-outline":"7.0.0-alpha.33","@storybook/addon-storyshots":"7.0.0-alpha.33","@storybook/addon-storyshots-puppeteer":"7.0.0-alpha.33","@storybook/addon-storysource":"7.0.0-alpha.33","@storybook/addon-toolbars":"7.0.0-alpha.33","@storybook/addon-viewport":"7.0.0-alpha.33","@storybook/addons":"7.0.0-alpha.33","@storybook/angular":"7.0.0-alpha.33","@storybook/api":"7.0.0-alpha.33","@storybook/blocks":"7.0.0-alpha.33","@storybook/builder-manager":"7.0.0-alpha.33","@storybook/builder-vite":"7.0.0-alpha.33","@storybook/builder-webpack5":"7.0.0-alpha.33","@storybook/channel-postmessage":"7.0.0-alpha.33","@storybook/channel-websocket":"7.0.0-alpha.33","@storybook/channels":"7.0.0-alpha.33","@storybook/cli":"7.0.0-alpha.33","@storybook/client-api":"7.0.0-alpha.33","@storybook/client-logger":"7.0.0-alpha.33","@storybook/codemod":"7.0.0-alpha.33","@storybook/components":"7.0.0-alpha.33","@storybook/core-client":"7.0.0-alpha.33","@storybook/core-common":"7.0.0-alpha.33","@storybook/core-events":"7.0.0-alpha.33","@storybook/core-server":"7.0.0-alpha.33","@storybook/core-webpack":"7.0.0-alpha.33","@storybook/csf-tools":"7.0.0-alpha.33","@storybook/docs-tools":"7.0.0-alpha.33","@storybook/ember":"7.0.0-alpha.33","@storybook/html":"7.0.0-alpha.33","@storybook/html-webpack5":"7.0.0-alpha.33","@storybook/instrumenter":"7.0.0-alpha.33","@storybook/node-logger":"7.0.0-alpha.33","@storybook/postinstall":"7.0.0-alpha.33","@storybook/preact":"7.0.0-alpha.33","@storybook/preact-webpack5":"7.0.0-alpha.33","@storybook/preset-html-webpack":"7.0.0-alpha.33","@storybook/preset-preact-webpack":"7.0.0-alpha.33","@storybook/preset-react-webpack":"7.0.0-alpha.33","@storybook/preset-server-webpack":"7.0.0-alpha.33","@storybook/preset-svelte-webpack":"7.0.0-alpha.33","@storybook/preset-vue-webpack":"7.0.0-alpha.33","@storybook/preset-vue3-webpack":"7.0.0-alpha.33","@storybook/preset-web-components-webpack":"7.0.0-alpha.33","@storybook/preview-web":"7.0.0-alpha.33","@storybook/react":"7.0.0-alpha.33","@storybook/react-vite":"7.0.0-alpha.33","@storybook/react-webpack5":"7.0.0-alpha.33","@storybook/router":"7.0.0-alpha.33","@storybook/server":"7.0.0-alpha.33","@storybook/server-webpack5":"7.0.0-alpha.33","@storybook/source-loader":"7.0.0-alpha.33","@storybook/store":"7.0.0-alpha.33","@storybook/svelte":"7.0.0-alpha.33","@storybook/svelte-vite":"7.0.0-alpha.33","@storybook/svelte-webpack5":"7.0.0-alpha.33","@storybook/telemetry":"7.0.0-alpha.33","@storybook/theming":"7.0.0-alpha.33","@storybook/ui":"7.0.0-alpha.33","@storybook/vue":"7.0.0-alpha.33","@storybook/vue-webpack5":"7.0.0-alpha.33","@storybook/vue3":"7.0.0-alpha.33","@storybook/vue3-vite":"7.0.0-alpha.33","@storybook/vue3-webpack5":"7.0.0-alpha.33","@storybook/web-components":"7.0.0-alpha.33","@storybook/web-components-webpack5":"7.0.0-alpha.33",sb:"7.0.0-alpha.33",storybook:"7.0.0-alpha.33"};var pe=console;function Me(){let e=xe.resolve("bower.json");if(!H.existsSync(e))return!1;let o=H.readFileSync(e,"utf8");return JSON.parse(o)}function K(e,o){let t=xe.resolve(e);if(!H.existsSync(t))return!1;let r=H.readFileSync(t,"utf8"),n=o?Jr(r):r;try{return JSON.parse(n)}catch(s){throw pe.error(Y.red(`Invalid json in file: ${t}`)),s}}var oe=(e,o)=>{let t=xe.resolve(e);return H.existsSync(t)?(H.writeFileSync(t,`${JSON.stringify(o,null,2)}
`),!0):!1},u=e=>(process.stdout.write(Y.cyan(" \u2022 ")+e),(o,t)=>{if(o){if(process.stdout.write(`. ${Y.red("\u2716")}
`),pe.error(`
     ${Y.red(o)}`),!t)return;let r=t.split(`
`).map(n=>`     ${Y.dim(n)}`).join(`
`);pe.error(`${r}
`);return}process.stdout.write(`. ${Y.green("\u2713")}
`)});function S(e){let o=e.split(`
`).map(t=>`    ${t}`).join(`
`);pe.log(o)}function jo(e,o){let t="";for(let r=0;r<o;r+=1)t+=e;return t}function Pe(e,o){let t=0,n=e.map(s=>(t=s.length>t?s.length:t,s)).map(s=>{let i=t-s.length,a=s+jo(" ",i);return a=jo(" ",o||2)+Y.inverse(` ${a} `),a}).join(`
`);pe.log(n)}async function Se(e,o){let t=[],r="^8.0.0-0",n=o.dependencies["babel-core"]||o.devDependencies["babel-core"];if(n){let s=await e.latestVersion("babel-core",n);Fr(s,"^6.0.0")&&(r="^7.0.0")}else if(!o.dependencies["@babel/core"]&&!o.devDependencies["@babel/core"]){let s=await e.getVersion("@babel/core");t.push(`@babel/core@${s}`)}if(!o.dependencies["babel-loader"]&&!o.devDependencies["babel-loader"]){let s=await e.getVersion("babel-loader",r);t.push(`babel-loader@${s}`)}return t}function _(e){let o=xe.resolve(e,"template-csf/");if(!H.existsSync(o))throw new Error("Couldn't find template dir");W.copySync(o,".",{overwrite:!0})}async function Eo(e,o){let t={javascript:"js",typescript:"ts"},r=async()=>{let i=R(),a=ce(i,"rendererAssets"),c=ce(a,e),l=ce(c,t[o]);if(await W.pathExists(l))return l;let d=ce(c,t.javascript);if(await W.pathExists(d))return d;if(await W.pathExists(c))return c;throw new Error(`Unsupported renderer: ${e}`)},s=await(async()=>await W.pathExists("./src")?"./src/stories":"./stories")();await W.copy(await r(),s,{overwrite:!0}),await W.copy(ce(R(),"rendererAssets/common"),s,{overwrite:!0})}function Ce(e){let o={...e.dependencies,...e.devDependencies},t=Object.keys(o).find(r=>D[r]);if(!t)throw new Error("Couldn't find any official storybook packages in package.json");return o[t]}var Ir=/[\s"\n]next.*?(\d+).*/,Ao=e=>{try{let o="";if(e.type==="npm")try{o=e.executeCommand("npm",["ls","next"])}catch{o=e.executeCommand("npm",["why","next"])}else o=e.executeCommand("yarn",["why","next"]);let[,t]=o.match(Ir);return t&&parseInt(t,10)?parseInt(t,10):!1}catch{}return!1};var Br=["vite.config.ts","vite.config.js","vite.config.mjs"],To=(e,o,t)=>{let r=e.dependencies?.[o]||e.devDependencies?.[o];return r&&typeof t=="function"?t(r):!!r},Gr=(e,o,t)=>{let r=e.peerDependencies?.[o];return r&&typeof t=="function"?t(r):!!r},Mr=(e,o)=>{let t={dependencies:[!1],peerDependencies:[!1],files:[!1]},{preset:r,files:n,dependencies:s,peerDependencies:i,matcherFunction:a}=o,c=[];Array.isArray(s)?c=s.map(d=>[d,void 0]):typeof s=="object"&&(c=Object.entries(s)),c.length>0&&(t.dependencies=c.map(([d,g])=>To(e,d,g)));let l=[];return Array.isArray(i)?l=i.map(d=>[d,void 0]):typeof i=="object"&&(l=Object.entries(i)),l.length>0&&(t.peerDependencies=l.map(([d,g])=>Gr(e,d,g))),Array.isArray(n)&&n.length>0&&(t.files=n.map(d=>Vr.existsSync(_r.join(process.cwd(),d)))),a(t)?r:null};function Lr(e={}){let o=[...Ro,Do].find(t=>Mr(e,t)!==null);return o?o.preset:"UNDETECTED"}function Oo(e){if(Nr.sync(Br))return S("Detected vite project, setting builder to @storybook/builder-vite"),"vite";let t=Ao(e);return t&&t>=11?"webpack5":"webpack5"}function Ue(e,o){return e&&!o&&e.devDependencies&&Co.reduce((t,r)=>t||!!e.devDependencies[`@storybook/${r}`],!1)?"ALREADY_HAS_STORYBOOK":!1}function $o(e){let o="javascript",t=Me();return!e&&!t||To(e||t,"typescript")&&(o="typescript"),o}function Fo(e,o={}){let t=Me();if(!e&&!t)return"UNDETECTED";let r=Ue(e,o.force);return r||(o.html?"HTML":Lr(e||t))}import ln,{join as dn}from"path";import Xo from"@storybook/semver";import*as Jo from"path";import*as Io from"fs";import{pathExists as Ur}from"fs-extra";function Re(){let e=K("angular.json",!0),o=Yr(e),t=e.projects[o].architect.build.options.tsConfig;return!t||!Io.existsSync(Jo.resolve(t))?!1:t}function _o(){let e=Re();return e?K(e,!0):!1}function Wr(e){let o=Re(),t={...e};return t.extends=`../${o}`,t}function Vo(e){let o;try{o=K(e)}catch(t){throw t.name==="SyntaxError"&&t.message.indexOf("Unexpected token /")>-1?new Error(`Comments are disallowed in ${e}`):t}o=Wr(o),oe(e,o)}function Yr(e){let{defaultProject:o,projects:t}=e;if(t?.storybook)return"storybook";if(o)return o;let r=t?Object.keys(t)[0]:void 0;if(r)return r}function No(){let{projects:e}=K("angular.json",!0);if(!e||Object.keys(e).length===0)throw new Error(`Could not find a project in your Angular workspace. 
Add a project and re-run the installation`)}async function Bo(){return await Ur("./tsconfig.base.json")?"tsconfig.base.json":"tsconfig.json"}import Ke from"fs-extra";import{dedent as Ho}from"ts-dedent";import De from"fs-extra";import{dedent as We}from"ts-dedent";async function Go({addons:e,extensions:o=["js","jsx","ts","tsx"],commonJs:t=!1,...r}){let n=await De.pathExists("./src")?"../src":"../stories",s={stories:[`${n}/**/*.stories.mdx`,`${n}/**/*.stories.@(${o.join("|")})`],addons:e,...r},i=`module.exports = ${JSON.stringify(s,null,2).replace(/\\"/g,'"').replace(/['"]%%/g,"").replace(/%%['"]/g,"").replace(/\\n/g,`\r
`)}`;await De.writeFile(`./.storybook/main.${t?"cjs":"js"}`,We`
      const path = require('path');
      ${i}
    `,{encoding:"utf8"})}var Hr={angular:{prefix:We`
      import { setCompodocJson } from "@storybook/addon-docs/angular";
      import docJson from "../documentation.json";
      setCompodocJson(docJson);
      
      `.trimStart(),extraParameters:"docs: { inlineStories: true },"}};async function Mo(e,o){let{prefix:t="",extraParameters:r=""}=Hr[e]||{},n=`./.storybook/preview.${o?"cjs":"js"}`;if(await De.pathExists(n))return;let s=We`
    ${t}
    export const parameters = {
      actions: { argTypesRegex: "^on[A-Z].*" },
      controls: {
        matchers: {
          color: /(background|color)$/i,
          date: /Date$/,
        },
      },
      ${r}
    }`.replace(`  
`,"").trim();await De.writeFile(n,s,{encoding:"utf8"})}import{sync as Yo}from"cross-spawn";import{sync as zr}from"find-up";import Xr from"@storybook/semver";import Lo from"chalk";import{gt as Kr,satisfies as Uo}from"@storybook/semver";import{sync as qr}from"cross-spawn";import Wo from"path";import Ye from"fs";var V=console;function q(e){let o=e.lastIndexOf("@");if(o<=0)return[e,void 0];let t=e.slice(0,o),r=e.slice(o+1);return[t,r]}var N=class{setRegistryURL(o){o?this.executeCommand("npm",["config","set","registry",o]):this.executeCommand("npm",["config","delete","registry"])}getRegistryURL(){let o=this.executeCommand("npm",["config","get","registry"]).trim();return o==="undefined"?void 0:o}constructor(o){this.cwd=o?.cwd}installDependencies(){let o=u("Preparing to install dependencies");o(),V.log(),V.log(),o=u("Installing dependencies");try{this.runInstall()}catch{o("An error occurred while installing dependencies."),process.exit(1)}o()}packageJsonPath(){return this.cwd?Wo.resolve(this.cwd,"package.json"):Wo.resolve("package.json")}readPackageJson(){let o=this.packageJsonPath();if(!Ye.existsSync(o))throw new Error(`Could not read package.json file at ${o}`);let t=Ye.readFileSync(o,"utf8");return JSON.parse(t)}writePackageJson(o){let t=`${JSON.stringify(o,null,2)}
`;Ye.writeFileSync(this.packageJsonPath(),t,"utf8")}retrievePackageJson(){let o;try{o=this.readPackageJson()}catch{this.initPackageJson(),o=this.readPackageJson()}return{...o,dependencies:{...o.dependencies},devDependencies:{...o.devDependencies}}}addDependencies(o,t){let{skipInstall:r}=o;if(r){let{packageJson:n}=o,s=t.reduce((i,a)=>{let[c,l]=q(a);return{...i,[c]:l}},{});o.installAsDevDependencies?n.devDependencies={...n.devDependencies,...s}:n.dependencies={...n.dependencies,...s},this.writePackageJson(n)}else try{this.runAddDeps(t,o.installAsDevDependencies)}catch(n){V.error("An error occurred while installing dependencies."),V.log(n.message),process.exit(1)}}removeDependencies(o,t){let{skipInstall:r}=o;if(r){let{packageJson:n}=o;t.forEach(s=>{n.devDependencies&&delete n.devDependencies[s],n.dependencies&&delete n.dependencies[s]}),this.writePackageJson(n)}else try{this.runRemoveDeps(t)}catch(n){V.error("An error occurred while removing dependencies."),V.log(n.message),process.exit(1)}}getVersionedPackages(o){return Promise.all(o.map(async t=>{let[r,n]=q(t);return`${r}@${await this.getVersion(r,n)}`}))}getVersions(...o){return Promise.all(o.map(t=>this.getVersion(t)))}async getVersion(o,t){let r;/(@storybook|^sb$|^storybook$)/.test(o)&&(r=D[o]);let n;try{n=await this.latestVersion(o,t)}catch(i){if(r)return V.warn(`
     ${Lo.yellow(i.message)}`),r;V.error(`
     ${Lo.red(i.message)}`),process.exit(1)}return`^${r&&(!t||Uo(r,t))&&Kr(r,n)?r:n}`}async latestVersion(o,t){return t?(await this.runGetVersions(o,!0)).reverse().find(n=>Uo(n,t)):this.runGetVersions(o,!1)}addStorybookCommandInScripts(o){let t=o?.port??6006,r=o?.staticFolder?`npx storybook dev -p ${t} -s ${o.staticFolder}`:`npx storybook dev -p ${t}`,n=o?.staticFolder?`npx storybook build -s ${o.staticFolder}`:"npx storybook build",s=o?.preCommand?this.getRunCommand(o.preCommand):void 0;this.addScripts({storybook:[s,r].filter(Boolean).join(" && "),"build-storybook":[s,n].filter(Boolean).join(" && ")})}addESLintConfig(){let o=this.retrievePackageJson();this.writePackageJson({...o,eslintConfig:{...o.eslintConfig,overrides:[...o.eslintConfig?.overrides||[],{files:["**/*.stories.*"],rules:{"import/no-anonymous-default-export":"off"}}]}})}addScripts(o){let t=this.retrievePackageJson();this.writePackageJson({...t,scripts:{...t.scripts,...o}})}addPackageResolutions(o){let t=this.retrievePackageJson(),r=this.getResolutions(t,o);this.writePackageJson({...t,...r})}executeCommand(o,t,r){let n=qr(o,t,{cwd:this.cwd,stdio:r??"pipe",encoding:"utf-8",shell:!0});if(n.status!==0)throw new Error(n.stderr??"");return n.stdout??""}};var le=class extends N{constructor(){super(...arguments);this.type="npm"}initPackageJson(){return this.executeCommand("npm",["init","-y"])}getRunStorybookCommand(){return"npm run storybook"}getRunCommand(t){return`npm run ${t}`}getNpmVersion(){return this.executeCommand("npm",["--version"])}hasLegacyPeerDeps(){return this.executeCommand("npm",["config","get","legacy-peer-deps","--location=project"]).trim()==="true"}setLegacyPeerDeps(){this.executeCommand("npm",["config","set","legacy-peer-deps=true","--location=project"])}needsLegacyPeerDeps(t){return Xr.gte(t,"7.0.0")&&!this.hasLegacyPeerDeps()}getInstallArgs(){return this.installArgs||(this.installArgs=this.needsLegacyPeerDeps(this.getNpmVersion())?["install","--legacy-peer-deps"]:["install"]),this.installArgs}getUninstallArgs(){return this.uninstallArgs||(this.uninstallArgs=this.needsLegacyPeerDeps(this.getNpmVersion())?["uninstall","--legacy-peer-deps"]:["uninstall"]),this.uninstallArgs}getResolutions(t,r){return{overrides:{...t.overrides,...r}}}runInstall(){this.executeCommand("npm",this.getInstallArgs(),"inherit")}runAddDeps(t,r){let n=[...t];r&&(n=["-D",...n]),this.executeCommand("npm",[...this.getInstallArgs(),...n],"inherit")}runRemoveDeps(t){let r=[...t];this.executeCommand("npm",[...this.getUninstallArgs(),...r],"inherit")}runGetVersions(t,r){let n=[r?"versions":"version","--json"],s=this.executeCommand("npm",["info",t,...n]);try{let i=JSON.parse(s);if(i.error)throw new Error(i.error.summary);return i}catch{throw new Error(`Unable to find versions of ${t} using npm`)}}};var je=class extends N{constructor(){super(...arguments);this.type="yarn2"}initPackageJson(){return this.executeCommand("yarn",["init"])}getRunStorybookCommand(){return"yarn storybook"}getRunCommand(t){return`yarn ${t}`}getResolutions(t,r){return{resolutions:{...t.resolutions,...r}}}runInstall(){this.executeCommand("yarn",[],"inherit")}runAddDeps(t,r){let n=[...t];r&&(n=["-D",...n]),this.executeCommand("yarn",["add",...n],"inherit")}runRemoveDeps(t){let r=[...t];this.executeCommand("yarn",["remove",...r],"inherit")}runGetVersions(t,r){let n=r?"versions":"version",s=["--fields",n,"--json"],i=this.executeCommand("yarn",["npm","info",t,...s]);try{return JSON.parse(i)[n]}catch{throw new Error(`Unable to find versions of ${t} using yarn 2`)}}};var Ee=class extends N{constructor(){super(...arguments);this.type="yarn1"}initPackageJson(){return this.executeCommand("yarn",["init","-y"])}getRunStorybookCommand(){return"yarn storybook"}getRunCommand(t){return`yarn ${t}`}getResolutions(t,r){return{resolutions:{...t.resolutions,...r}}}runInstall(){this.executeCommand("yarn",[],"inherit")}runAddDeps(t,r){let n=["--ignore-workspace-root-check",...t];r&&(n=["-D",...n]),this.executeCommand("yarn",["add",...n],"inherit")}runRemoveDeps(t){let r=["--ignore-workspace-root-check",...t];this.executeCommand("yarn",["remove",...r],"inherit")}runGetVersions(t,r){let n=[r?"versions":"version","--json"],s=this.executeCommand("yarn",["info",t,...n]);try{let i=JSON.parse(s);if(i.type==="inspect")return i.data;throw new Error(`Unable to find versions of ${t} using yarn`)}catch{throw new Error(`Unable to find versions of ${t} using yarn`)}}};var A=class{static getPackageManager(o=!1,t){if(o)return new le({cwd:t});let r=Qr(t),n=zr("yarn.lock",{cwd:t}),s=Zr(t);if(r&&(n||!s))return r===1?new Ee({cwd:t}):new je({cwd:t});if(s)return new le({cwd:t});throw new Error("Unable to find a usable package manager within NPM, Yarn and Yarn 2")}};function Zr(e){return Yo("npm",["--version"],{cwd:e,shell:!0}).status===0}function Qr(e){let o=Yo("yarn",["--version"],{cwd:e,shell:!0});if(o.status!==0)return;let t=o.output.toString().replace(/,/g,"").replace(/"/g,"");return/^1\.+/.test(t)?1:2}import{writeFile as en,access as on}from"fs-extra";import{logger as He}from"@storybook/node-logger";import tn from"path";import rn from"prompts";var Ae=async()=>{let e=process.cwd();return nn({target:e})},nn=async({target:e})=>{He.info(`Generating the storybook default babel config at ${e}`);let o=JSON.stringify({sourceType:"unambiguous",presets:[],plugins:[]},null,2),t=".babelrc.json",r=tn.join(e,t);if(await on(r).then(()=>!0,()=>!1)){let{overwrite:s}=await rn({type:"confirm",initial:!0,name:"overwrite",message:`${t} already exists. Would you like overwrite it?`});if(s===!1){He.warn("Cancelled, babel config file was NOT written to file-system.");return}}He.info(`Writing file to ${r}`),await en(r,o)};var Ko={extraPackages:[],extraAddons:[],staticDir:void 0,addScripts:!0,addComponents:!0,addBabel:!0,addESLint:!1,extraMain:void 0,framework:void 0,extensions:void 0,commonJs:!1},sn=e=>{let o=D;if(o[e])return e;let t=`@storybook/${e}`;return o[t]?t:e},Te=e=>`%%path.dirname(require.resolve(path.join('${e}', 'package.json')))%%`,an=(e,o,t)=>{let r=`@storybook/${e}-${o}`,n=t?Te(r):r,s=`@storybook/${e}`,i=t?Te(s):s,a=sn(o),c=t?Te(a):a,l=!!D[r],d=!!D[s];if(e==="angular")return{packages:[s],framework:i,rendererId:"angular",type:"framework"};if(l)return{packages:[r],framework:n,rendererId:e,type:"framework"};if(d)return{packages:[s,a],builder:c,renderer:i,rendererId:e,type:"renderer"};throw new Error(`Could not find the framework (${r}) or renderer (${s}) package`)},cn=e=>e.map(o=>q(o)[0]),pn=e=>["react","angular","preact","svelte","vue","vue3","html"].includes(e),qo;async function m(e,o,{language:t,builder:r="webpack5",pnp:n,commonJs:s},i,a=Ko){let{extraAddons:c,extraPackages:l,staticDir:d,addScripts:g,addComponents:k,addBabel:f,addESLint:h,extraMain:ee,extensions:Be}={...Ko,...a},{packages:bo,type:ko,renderer:Bi,rendererId:vr,framework:xr,builder:Pr}=an(i,r,n),Ge=["@storybook/addon-links","@storybook/addon-essentials",...cn(c)],y=["@storybook/addon-links","@storybook/addon-essentials",...c];pn(vr)&&(Ge.push("@storybook/addon-interactions"),y.push("@storybook/addon-interactions","@storybook/testing-library"));let Sr=e.type==="yarn2"?["@storybook/addon-docs","@mdx-js/react@1.x.x"]:[],Cr=await Ke.readdir(process.cwd()),ke=e.retrievePackageJson(),Rr=new Set(Object.keys({...ke.dependencies,...ke.devDependencies}));if(ko==="renderer")throw new Error(Ho`
        Sorry, for now, you can not do this, please use a framework such as @storybook/react-webpack5

        https://github.com/storybookjs/storybook/issues/18360
      `);let Dr=["storybook",`@storybook/${i}`,...bo,...y,...l,...Sr].filter(Boolean).filter($=>!Rr.has(q($)[0])),jr=await e.getVersionedPackages(Dr);if(await Ke.ensureDir("./.storybook"),await Go({framework:{name:xr,options:a.framework||{}},addons:n?Ge.map(Te):Ge,extensions:Be,commonJs:s,...ee,...ko!=="framework"?{core:{builder:Pr}}:{}}),await Mo(i,a.commonJs),k&&await Eo(i,t),bo.find($=>$.match(/^@storybook\/.*-vite$/))){let $=Ho(qo||(qo=vo([`
      <script>
        window.global = window;
      <\/script>
    `])));await Ke.writeFile(".storybook/preview-head.html",$,{encoding:"utf8"})}let Er=f&&r!=="vite"?await Se(e,ke):[];!Cr.some($=>$.startsWith(".babel")||$.startsWith("babel")||$==="package.json")&&await Ae(),e.addDependencies({...o,packageJson:ke},[...jr,...Er]),g&&e.addStorybookCommandInScripts({port:6006,staticFolder:d}),h&&e.addESLintConfig()}function mn(){let e=_o(),o="**/*.stories.*";if(!e)return;let{exclude:t=[]}=e;t.includes(o)||(e.exclude=[...t,o],oe(Re(),e))}var un=async(e,o,t)=>{No();let r=Xo.coerce(e.retrievePackageJson().dependencies["@angular/core"])?.version,s=Xo.gte(r,"12.0.0")?{...t,builder:"webpack5"}:t;await m(e,o,s,"angular",{extraPackages:["@compodoc/compodoc"],addScripts:!1});let i=dn(R(),"templates","angular");_(i),mn(),Vo(ln.resolve("./.storybook/tsconfig.json"));let a=await Bo();e.addScripts({"docs:json":`compodoc -p ./${a} -e json -d .`}),e.addStorybookCommandInScripts({port:6006,preCommand:"docs:json"})},zo=un;import{join as gn}from"path";function fn(){let e=K("tsconfig.json",!0),o="**/*.stories.ts";if(!e)return;let{exclude:t=[]}=e;t.includes(o)||(e.exclude=[...t,o],oe("tsconfig.json",e))}var yn=async(e,o,t)=>{fn(),await m(e,o,t,"aurelia",{extraPackages:["aurelia"]});let r=gn(R(),"templates","aurelia");_(r)},Zo=yn;var bn=async(e,o,t)=>{await m(e,o,t,"ember",{extraPackages:["babel-plugin-ember-modules-api-polyfill","babel-plugin-htmlbars-inline-precompile"],staticDir:"dist"})},Qo=bn;var kn=async(e,o,t)=>{await m(e,o,t,"react")},qe=kn;import{join as hn}from"path";import wn from"chalk";import et from"shelljs";var vn=async(e,o,t)=>{let r=et.ls("-d","ios/*.xcodeproj").stdout;if(r){let h=r.slice(4,r.length-10-1);h?et.sed("-i","%APP_NAME%",h,"storybook/index.js"):S(wn.red("ERR: Could not determine project name, to fix: https://github.com/storybookjs/storybook/issues/1277"))}let n=e.retrievePackageJson(),s=!n.dependencies["react-dom"]&&!n.devDependencies["react-dom"],i=n.dependencies.react,a=["@storybook/addon-links@^5.3","@storybook/addon-knobs@^5.3","@storybook/addon-actions@^5.3"],l=[...["@storybook/addon-ondevice-knobs","@storybook/addon-ondevice-actions"],"@storybook/react-native",t&&"@storybook/react-native-server"].filter(Boolean),d=await e.getVersionedPackages(l),k=[...await Se(e,n),...d,...a,s&&i&&`react-dom@${i}`].filter(Boolean);e.addDependencies({...o,packageJson:n},k),t&&e.addStorybookCommandInScripts({port:7007});let f=hn(R(),"templates","react-native");_(f)},ot=vn;import tt from"path";import xn from"fs";import rt from"@storybook/semver";var Pn=async(e,o,t)=>{let r=tt.join(__dirname,"..","..","..","..","..",".."),n=t.linkable?{webpackFinal:`%%(config) => {
      // add monorepo root as a valid directory to import modules from
      config.resolve.plugins.forEach((p) => {
        if (Array.isArray(p.appSrcs)) {
          p.appSrcs.push('${r}');
              }
            });
          return config;
          }
    %%`}:{},s=rt.coerce(e.retrievePackageJson().dependencies["react-scripts"])?.version,i=s&&rt.gte(s,"5.0.0"),a=i?{...t,builder:"webpack5"}:t,c=["@storybook/node-logger"];i&&(c.push("webpack"),c.push("babel-plugin-named-exports-order"),c.push("prop-types")),await m(e,o,a,"react",{extraAddons:[`@storybook/preset-create-react-app${i?"":"@3"}`],extraPackages:c,staticDir:xn.existsSync(tt.resolve("./public"))?"public":void 0,addBabel:!1,addESLint:!0,extraMain:n})},nt=Pn;var Sn=async(e,o,t)=>{await m(e,o,t,"vue")},st=Sn;var Cn=async(e,o,t)=>{await m(e,o,t,"vue",{extraPackages:["vue-loader@^15.7.0"]})},it=Cn;var Rn=async(e,o,t)=>{await m(e,o,t,"vue3",{extraPackages:["vue-loader@^16.0.0"]})},at=Rn;var Dn=async(e,o,t)=>{await m(e,o,t,"react")},ct=Dn;var jn=async(e,o,t)=>{await m(e,o,t,"mithril")},pt=jn;var En=async(e,o,t)=>{await m(e,o,t,"marionette")},lt=En;var An=async(e,o,t)=>{await m(e,o,t,"marko")},dt=An;var Tn=async(e,o,t)=>{await m(e,o,t,"html")},mt=Tn;var On=async(e,o,t)=>m(e,o,t,"web-components",{extraPackages:["lit-html"]}),ut=On;var $n=async(e,o,t)=>{await m(e,o,t,"riot",{extraPackages:["riot-tag-loader"]})},gt=$n;var Fn=async(e,o,t)=>{await m(e,o,t,"preact")},ft=Fn;import yt from"fs-extra";import{logger as Xe}from"@storybook/node-logger";var Jn=async(e,o,t)=>{let r;if(yt.existsSync("./svelte.config.js"))Xe.info("Configuring preprocessor from 'svelte.config.js'"),r={svelteOptions:{preprocess:'%%require("../svelte.config.js").preprocess%%'}};else if(yt.existsSync("./svelte.config.cjs"))Xe.info("Configuring preprocessor from 'svelte.config.cjs'"),r={svelteOptions:{preprocess:'%%require("../svelte.config.cjs").preprocess%%'}};else{let n=e.retrievePackageJson();n.devDependencies&&n.devDependencies["svelte-preprocess"]&&(Xe.info("Configuring preprocessor with 'svelte-preprocess'"),r={svelteOptions:{preprocess:'%%require("svelte-preprocess")()%%'}})}await m(e,o,t,"svelte",{extraPackages:["svelte","svelte-loader"],extensions:["js","jsx","ts","tsx","svelte"],extraMain:r,commonJs:!0})},bt=Jn;var In=async(e,o,t)=>{let[r]=await e.getVersions("rax"),n=e.retrievePackageJson(),s=n.dependencies.rax||r;n.dependencies.rax=n.dependencies.rax||s,n.dependencies["rax-image"]=n.dependencies["rax-image"]||s,n.dependencies["rax-link"]=n.dependencies["rax-link"]||s,n.dependencies["rax-text"]=n.dependencies["rax-text"]||s,n.dependencies["rax-view"]=n.dependencies["rax-view"]||s,e.writePackageJson(n),await m(e,o,t,"rax",{extraPackages:["rax"]})},kt=In;import{join as _n}from"path";var Vn=async(e,o,t)=>{await m(e,o,t,"server",{extensions:["json"]});let r=_n(R(),"templates","server");_(r)},ht=Vn;import ds from"prompts";import ie from"chalk";import ms from"boxen";import Ze from"chalk";import{dedent as Mn}from"ts-dedent";import wt from"@storybook/semver";import te from"chalk";import{dedent as ze}from"ts-dedent";import re from"@storybook/semver";import{readConfig as Nn,writeConfig as Bn}from"@storybook/csf-tools";import{getStorybookInfo as Gn}from"@storybook/core-common";var ne=console,j={id:"webpack5",async checkWebpack5Builder(e){let{mainConfig:o,version:t}=Gn(e),r=t&&re.coerce(t)?.version;if(!r)return ne.warn(ze`
        âŒ Unable to determine storybook version, skipping ${te.cyan("webpack5")} fix.
        ðŸ¤” Are you running automigrate from your project directory?
      `),null;if(re.lt(r,"6.3.0"))return ne.warn(ze`
          Detected SB 6.3 or below, please upgrade storybook to use webpack5.

          To upgrade to the latest stable release, run this from your project directory:

          ${te.cyan("npx storybook upgrade")}

          Add the ${te.cyan("--prerelease")} flag to get the latest prerelease.
        `.trim()),null;if(re.gte(r,"7.0.0"))return null;if(!o)return ne.warn("Unable to find storybook main.js config"),null;let n=await Nn(o),s=n.getFieldValue(["core","builder"]);return s&&s!=="webpack4"?(ne.info(`Found builder ${s}, skipping`),null):{storybookVersion:t,main:n}},async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t.webpack||r.webpack,s=re.coerce(n)?.version;if(!s||re.lt(s,"5.0.0")||re.gte(s,"6.0.0"))return null;let i=await this.checkWebpack5Builder(o);return i?{webpackVersion:n,...i}:null},prompt({webpackVersion:e}){let o=te.cyan(`webpack ${e}`);return ze`
      We've detected you're running ${o}.
      Your Storybook's main.js files specifies webpack4, which is incompatible.
      
      To run Storybook in webpack5-mode, we can install Storybook's ${te.cyan("@storybook/builder-webpack5")} for you.

      More info: ${te.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#webpack-5-manager-build")}
    `},async run({result:{main:e,storybookVersion:o,webpackVersion:t},packageManager:r,dryRun:n}){let s=[`@storybook/builder-webpack5@${o}`];t||s.push("webpack@5"),ne.info(`\u2705 Adding dependencies: ${s}`),n||r.addDependencies({installAsDevDependencies:!0},s),ne.info("\u2705 Setting `core.builder` to `@storybook/builder-webpack5` in main.js"),n||(e.setFieldValue(["core","builder"],"@storybook/builder-webpack5"),await Bn(e))}};var vt={id:"cra5",async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t["react-scripts"]||r["react-scripts"],s=wt.coerce(n)?.version;if(!s||wt.lt(s,"5.0.0"))return null;let i=await j.checkWebpack5Builder(o);return i?{craVersion:n,...i}:null},prompt({craVersion:e,...o}){let t=Ze.cyan(`Create React App (CRA) ${e}`);return console.log({...o}),Mn`
      We've detected you are running ${t} which is powered by webpack5.
      Your Storybook's main.js files specifies webpack4, which is incompatible.

      In order to work with your version of CRA, we need to install Storybook's ${Ze.cyan("@storybook/builder-webpack5")}.

      More info: ${Ze.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#cra5-upgrade")}
    `},async run(e){return j.run({...e,result:{webpackVersion:null,...e.result}})}};import Qe from"chalk";import{dedent as Ln}from"ts-dedent";import xt from"@storybook/semver";var Pt={id:"angular12",async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t["@angular/core"]||r["@angular/core"],s=xt.coerce(n)?.version;if(!s||xt.lt(s,"12.0.0"))return null;let i=await j.checkWebpack5Builder(o);return i?{angularVersion:n,...i}:null},prompt({angularVersion:e}){let o=Qe.cyan(`Angular ${e}`);return Ln`
      We've detected you are running ${o} which is powered by webpack5.
      Your Storybook's main.js files specifies webpack4, which is incompatible.

      In order to work with your version of Angular, we need to install Storybook's ${Qe.cyan("@storybook/builder-webpack5")}.

      More info: ${Qe.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#angular12-upgrade")}
    `},async run(e){return j.run({...e,result:{webpackVersion:null,...e.result}})}};import Oe from"chalk";import{dedent as Un}from"ts-dedent";import St from"@storybook/semver";var Ct={id:"vue3",async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t.vue||r.vue,s=St.coerce(n)?.version;if(!s||St.lt(s,"3.0.0"))return null;let i=await j.checkWebpack5Builder(o);return i?{vueVersion:n,...i}:null},prompt({vueVersion:e,storybookVersion:o}){let t=Oe.cyan(`Vue ${e}`),r=Oe.cyan(`Storybook ${o}`);return Un`
      We've detected you are running ${t} with Storybook.
      ${r} runs webpack4 by default, which is incompatible.

      In order to work with your version of Vue, we need to install Storybook's ${Oe.cyan("webpack5 builder")}.

      More info: ${Oe.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#vue3-upgrade")}
    `},async run(e){return j.run({...e,result:{webpackVersion:null,...e.result}})}};import eo from"chalk";import{dedent as Rt}from"ts-dedent";import Dt from"@storybook/semver";import{readConfig as Wn,writeConfig as Yn}from"@storybook/csf-tools";import{getStorybookInfo as Hn}from"@storybook/core-common";var oo=console,jt={id:"mainjsFramework",async check({packageManager:e}){let o=e.retrievePackageJson(),{mainConfig:t,framework:r,version:n}=Hn(o);if(!t)return oo.warn("Unable to find storybook main.js config, skipping"),null;let s=n&&Dt.coerce(n)?.version;if(!s)return oo.warn(Rt`
        âŒ Unable to determine storybook version, skipping ${eo.cyan("mainjsFramework")} fix.
        ðŸ¤” Are you running automigrate from your project directory?
      `),null;let i=await Wn(t),a=i.getFieldValue(["framework"]),c=i.getFieldValue(["features"]);return a?null:c?.breakingChangesV7||c?.storyStoreV7||Dt.gte(s,"7.0.0")?{main:i,framework:`@storybook/${r}`}:null},prompt({framework:e}){let o=eo.cyan(`framework: '${e}'`);return Rt`
      We've detected that your main.js configuration file does not specify the
      'framework' field, which is a requirement in SB7.0 and above. We can add one
      for you automatically:

      ${o}

      More info: ${eo.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#mainjs-framework-field")}
    `},async run({result:{main:e,framework:o},dryRun:t}){oo.info(`\u2705 Setting 'framework' to '${o}' in main.js`),t||(e.setFieldValue(["framework"],o),await Yn(e))}};import qn from"chalk";import{dedent as Tt}from"ts-dedent";import{readConfig as Ot,writeConfig as Xn}from"@storybook/csf-tools";import{getStorybookInfo as zn}from"@storybook/core-common";import Et from"fs-extra";var to=["js","cjs"],Kn=["yaml","yml","json"],At=()=>{let e=".eslintrc",o=Kn.find(r=>Et.existsSync(`${e}.${r}`));if(o)throw new Error(o);let t=to.find(r=>Et.existsSync(`${e}.${r}`));return t?`${e}.${t}`:null};var de=console,$t={id:"eslintPlugin",async check({packageManager:e}){let o=e.retrievePackageJson(),{dependencies:t,devDependencies:r}=o,n=t["eslint-plugin-storybook"]||r["eslint-plugin-storybook"],s=t.eslint||r.eslint;if(n||!s)return null;let{mainConfig:i}=zn(o);if(!i)return de.warn("Unable to find storybook main.js config, skipping"),null;let a,c;try{a=At()}catch(d){c=d.message}if(!a&&!c)return de.warn("Unable to find .eslintrc config file, skipping"),null;let l=await Ot(i);return{eslintFile:a,main:l,unsupportedExtension:c}},prompt(){return Tt`
      We've detected you are not using our eslint-plugin.

      In order to have the best experience with Storybook and follow best practices, we advise you to install eslint-plugin-storybook.

      More info: ${qn.yellow("https://github.com/storybookjs/eslint-plugin-storybook#readme")}
    `},async run({result:{eslintFile:e,unsupportedExtension:o},packageManager:t,dryRun:r}){let n=["eslint-plugin-storybook"];if(de.info(`\u2705 Adding dependencies: ${n}`),r||t.addDependencies({installAsDevDependencies:!0},n),!r&&o)throw new Error(Tt`
          âš ï¸ The plugin was successfuly installed but failed to configure.
          
          Found an .eslintrc config file with an unsupported automigration format: ${o}.
          Supported formats for automigration are: ${to.join(", ")}.

          Please refer to https://github.com/storybookjs/eslint-plugin-storybook#usage to finish setting up the plugin manually.
      `);let s=await Ot(e);if(de.info(`\u2705 Configuring eslint rules in ${s.fileName}`),!r){de.info("\u2705 Adding Storybook to extends list");let i=s.getFieldValue(["extends"])||[],a=Array.isArray(i)?i:[i];s.setFieldValue(["extends"],[...a,"plugin:storybook/recommended"]),await Xn(s)}}};import ro from"chalk";import{dedent as Zn}from"ts-dedent";import{readConfig as Qn,writeConfig as es}from"@storybook/csf-tools";import{getStorybookInfo as os}from"@storybook/core-common";var $e=console,Ft={id:"builder-vite",async check({packageManager:e}){let o=e.retrievePackageJson(),{mainConfig:t}=os(o);if(!t)return $e.warn("Unable to find storybook main.js config"),null;let r=await Qn(t),n=r.getFieldValue(["core","builder"]);return(typeof n=="string"?n:n?.name)!=="storybook-builder-vite"?null:{builder:n,main:r,packageJson:o}},prompt({builder:e}){let o=ro.cyan(JSON.stringify(e,null,2));return Zn`
      We've detected you're using the community vite builder: ${o}
      
      'storybook-builder-vite' is deprecated and now located at ${ro.cyan("@storybook/builder-vite")}.

      We can upgrade your project to use the new builder automatically.
      
      More info: ${ro.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#vite-builder-renamed")}
    `},async run({result:{builder:e,main:o,packageJson:t},packageManager:r,dryRun:n}){let{dependencies:s={},devDependencies:i={}}=t;if($e.info("Removing existing 'storybook-builder-vite' dependency"),n||(delete s["storybook-builder-vite"],delete i["storybook-builder-vite"],r.writePackageJson(t)),$e.info("Adding '@storybook/builder-vite' as dev dependency"),n||r.addDependencies({installAsDevDependencies:!0},["@storybook/builder-vite"]),$e.info("Updating main.js to use vite builder"),!n){let a=typeof e=="string"?"@storybook/builder-vite":{name:"@storybook/builder-vite",options:e.options};o.setFieldValue(["core","builder"],a),await es(o)}}};import Jt from"chalk";import{dedent as ts}from"ts-dedent";var It={id:"npm7",async check({packageManager:e}){if(e.type!=="npm")return null;let o=e.getNpmVersion();return e.needsLegacyPeerDeps(o)?{npmVersion:o}:null},prompt({npmVersion:e}){let o=Jt.cyan(`npm ${e}`);return ts`
      We've detected you are running ${o} which has peer dependency semantics which Storybook is incompatible with.

      In order to work with Storybook's package structure, you'll need to run \`npm\` with the
      \`--legacy-peer-deps=true\` flag. We can generate an \`.npmrc\` which will do that automatically.
      
      More info: ${Jt.yellow("https://github.com/storybookjs/storybook/issues/18298")}
    `},async run({packageManager:e}){e.setLegacyPeerDeps()}};import E from"chalk";import{dedent as rs}from"ts-dedent";import _t from"@storybook/semver";import{getStorybookInfo as ns}from"@storybook/core-common";var T=console,ss=e=>{let o={custom:{},official:{}};return Object.keys(e).forEach(t=>{t==="storybook"||t==="build-storybook"?o.official[t]=e[t]:(e[t].match(/start-storybook/)||e[t].match(/build-storybook/))&&(o.custom[t]=e[t])}),o},Vt={id:"sb-scripts",async check({packageManager:e}){let o=e.retrievePackageJson(),{scripts:t={},devDependencies:r,dependencies:n}=o,{version:s}=ns(o),i={...n,...r},a=s&&_t.coerce(s)?.version;if(!a)return T.warn(rs`
        âŒ Unable to determine storybook version, skipping ${E.cyan("sb-scripts")} fix.
        ðŸ¤” Are you running automigrate from your project directory?
      `),null;if(i.sb||i.storybook)return null;let c=ss(t);return Object.keys(c.official).length===0&&Object.keys(c.custom).length===0?null:(Object.keys(c.official).forEach(l=>{c.official[l]=c.official[l].replace("start-storybook","storybook dev").replace("build-storybook","storybook build")}),_t.gte(a,"7.0.0")?{packageJson:o,storybookScripts:c,storybookVersion:s}:null)},prompt({storybookVersion:e}){let o=E.cyan(`Storybook ${e}`),t=[`Starting in Storybook 7, the ${E.yellow("start-storybook")} and ${E.yellow("build-storybook")} binaries have changed to ${E.magenta("storybook dev")} and ${E.magenta("storybook build")} respectively.`,`In order to work with ${o}, Storybook's ${E.magenta("storybook")} binary has to be installed and your storybook scripts have to be adjusted to use the binary. We can install the storybook binary and attempt to adjust your scripts for you.`].join(`
`);return[`We've detected you are using ${o} with scripts from previous versions of Storybook.`,t,`More info: ${E.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#start-storybook--build-storybook-binaries-removed")}`].filter(Boolean).join(`

`)},async run({result:{storybookScripts:e,packageJson:o},packageManager:t,dryRun:r}){if(T.log(),T.info("Adding 'storybook' as dev dependency"),T.log(),!r){let n=Ce(o);t.addDependencies({installAsDevDependencies:!0},[`storybook@${n}`])}if(T.info("Updating scripts in package.json"),T.log(),!r&&Object.keys(e.official).length>0){let n=["Migrating your scripts to:",E.yellow(JSON.stringify(e.official,null,2))].join(`
`);T.log(n),T.log(),t.addScripts(e.official)}if(!r&&Object.keys(e.custom).length>0){let n=["We detected custom scripts that we can't automigrate:",E.yellow(JSON.stringify(e.custom,null,2)),`
`,`Please manually migrate the ones applicable and use the documentation below for reference: ${E.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#start-storybook--build-storybook-binaries-removed")}`].join(`
`);T.log(n),T.log()}}};import X from"chalk";import no from"ts-dedent";import Fe from"@storybook/semver";import{readConfig as is,writeConfig as as}from"@storybook/csf-tools";import{getStorybookInfo as cs}from"@storybook/core-common";var se=console,Nt={"@storybook/react":{webpack5:"@storybook/react-webpack5",vite:"@storybook/react-vite"},"@storybook/preact":{webpack5:"@storybook/preact-webpack5"},"@storybook/server":{webpack5:"@storybook/server-webpack5"},"@storybook/angular":{webpack5:"@storybook/angular"},"@storybook/vue":{webpack5:"@storybook/vue-webpack5"},"@storybook/vue3":{webpack5:"@storybook/vue3-webpack5",vite:"@storybook/vue3-vite"},"@storybook/svelte":{webpack5:"@storybook/svelte-webpack5",vite:"@storybook/svelte-vite"},"@storybook/web-components":{webpack5:"@storybook/web-components-webpack5"},"@storybook/html":{webpack5:"@storybook/html-webpack5"}},ps=e=>typeof e=="string"?e.includes("vite")?"vite":"webpack5":e?.name.includes("vite")?"vite":"webpack5",ls=(e,o)=>o.getFieldValue([`${e}Options`])||{},Bt={id:"newFrameworks",async check({packageManager:e}){let o=e.retrievePackageJson(),t={...o.dependencies,...o.devDependencies},{mainConfig:r,version:n,framework:s}=cs(o);if(!r)return se.warn("Unable to find storybook main.js config, skipping"),null;let i=n&&Fe.coerce(n)?.version;if(!i)return se.warn(no`
        âŒ Unable to determine storybook version, skipping ${X.cyan("newFrameworks")} fix.
        ðŸ¤” Are you running automigrate from your project directory?
      `),null;if(!Fe.gte(i,"7.0.0"))return null;let a=await is(r),c=a.getFieldValue(["framework"]),l=a.getFieldValue(["core","builder"]);if(!c||!Object.keys(Nt).includes(c))return null;let g={name:ps(l),options:a.getFieldValue(["core","builder","options"])||{}},k=Nt[c][g.name];if(!k)return null;if(t.vite&&Fe.lt(Fe.coerce(t.vite).version,"3.0.0"))return se.warn(no`
        âŒ Detected Vite ${t.vite}, which is unsupported in Storybook 7.0, so the ${X.cyan("newFrameworks")} fix will be skipped.
      Please upgrade vite to 3.0.0 or higher and rerun this automigration with "npx storybook@future automigrate".
      `),null;let f=ls(s,a),h=["@storybook/builder-webpack5","@storybook/manager-webpack5","@storybook/builder-webpack4","@storybook/manager-webpack4","@storybook/builder-vite","storybook-builder-vite"].filter(Be=>t[Be]),ee=[];return k!==c&&ee.push(k),{main:a,dependenciesToAdd:ee,dependenciesToRemove:h,frameworkPackage:k,frameworkOptions:f,builderInfo:g,packageJson:o}},prompt(){return no`
      We've detected you are using an older format of Storybook frameworks and builders.

      In Storybook 7, frameworks also specify the builder to be used.

      We can remove the dependencies that are no longer needed and install the new framework that already includes the builder.

      To learn more about the framework field, see: ${X.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#framework-field-mandatory")}

      ${X.underline(X.bold(X.cyan("Webpack4 users")))}

      Unless you're using Storybook's Vite builder, this automigration will install a Webpack5-based framework.
      
      If you were using Storybook's Webpack4 builder (default in 6.x, discontinued in 7.0), this could be a breaking
      change--especially if your project has a custom webpack configuration.
      
      To learn more about migrating from Webpack4, see: ${X.yellow("https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#webpack4-support-discontinued")}
    `},async run({result:{dependenciesToAdd:e,dependenciesToRemove:o,main:t,frameworkPackage:r,frameworkOptions:n,builderInfo:s,packageJson:i},packageManager:a,dryRun:c}){if(se.info(`\u2705 Removing legacy dependencies: ${o.join(", ")}`),c||a.removeDependencies({skipInstall:e.length>0,packageJson:i},o),e.length>0&&(se.info(`\u2705 Installing new dependencies: ${e.join(", ")}`),!c)){let l=Ce(i),d=e.map(g=>`${g}@${l}`);a.addDependencies({installAsDevDependencies:!0},d)}if(!c){se.info("\u2705 Updating framework field in main.js");let l=t.getFieldValue(["core"]);t.setFieldValue(["framework","name"],r),t.setFieldValue(["framework","options"],n),l?.builder&&delete l.builder,Object.keys(s.options).length>0&&t.setFieldValue(["framework","options","builder"],s.options),l&&(Object.keys(l).length===0?t.setFieldValue(["core"],{}):t.setFieldValue(["core"],l)),await as(t)}}};var Je=[vt,j,Pt,Ct,jt,$t,Ft,It,Vt,Bt];var x=console,ae=async({fixId:e,dryRun:o,yes:t}={})=>{let r=A.getPackageManager(),n=e?Je.filter(s=>s.id===e):Je;x.info("\u{1F50E} checking possible migrations..");for(let s=0;s<n.length;s+=1){let i=Je[s],a;try{a=await i.check({packageManager:r})}catch{x.info(`failed to check fix: ${i.id}`)}if(a){x.info(`\u{1F50E} found a '${ie.cyan(i.id)}' migration:`),x.info();let c=i.prompt(a);x.info(ms(c,{borderStyle:"round",padding:1,borderColor:"#F1618C"}));let l;if(o?l={fix:!1}:t?l={fix:!0}:l=await ds({type:"confirm",name:"fix",message:`Do you want to run the '${ie.cyan(i.id)}' migration on your project?`}),l.fix)try{await i.run({result:a,packageManager:r,dryRun:o}),x.info(`\u2705 ran ${ie.cyan(i.id)} migration`)}catch(d){x.info(`\u274C error when running ${ie.cyan(i.id)} migration:`),x.info(d),x.info()}else x.info(`Skipping the ${ie.cyan(i.id)} migration.`),x.info(),x.info(`If you change your mind, run '${ie.cyan("npx storybook@next automigrate")}'`)}}x.info(),x.info("\u2705 migration check successfully ran"),x.info()};var v=console,Gt=(e,o,t)=>{let r={installAsDevDependencies:!0,skipInstall:t.skipInstall},n;try{n=o.readPackageJson()}catch{}let i={language:$o(n),builder:t.builder||Oo(o),linkable:!!t.linkable,commonJs:t.commonJs,pnp:t.usePnp};return(async()=>{switch(e){case"ALREADY_HAS_STORYBOOK":return v.log(),S("There seems to be a Storybook already available in this project."),S(`Apply following command to force:
`),Pe(["sb init [options] -f"]),v.log(),Promise.resolve();case"REACT_SCRIPTS":return nt(o,r,i).then(u('Adding Storybook support to your "Create React App" based project'));case"REACT":return qe(o,r,i).then(u(`Adding Storybook support to your "React" app
`));case"REACT_NATIVE":return(t.yes?Promise.resolve({server:!0}):so([{type:"confirm",name:"server",message:"Do you want to install dependencies necessary to run Storybook server? You can manually do it later by install @storybook/react-native-server",initial:!1}])).then(({server:c})=>ot(o,r,c)).then(u(`Adding Storybook support to your "React Native" app
`));case"WEBPACK_REACT":return ct(o,r,i).then(u(`Adding Storybook support to your "Webpack React" app
`));case"REACT_PROJECT":return qe(o,r,i).then(u(`Adding Storybook support to your "React" library
`));case"SFC_VUE":return st(o,r,i).then(u(`Adding Storybook support to your "Single File Components Vue" app
`));case"VUE":return it(o,r,i).then(u(`Adding Storybook support to your "Vue" app
`));case"VUE3":return at(o,r,i).then(u(`Adding Storybook support to your "Vue 3" app
`));case"ANGULAR":return zo(o,r,i).then(u(`Adding Storybook support to your "Angular" app
`));case"EMBER":return Qo(o,r,i).then(u(`Adding Storybook support to your "Ember" app
`));case"MITHRIL":return pt(o,r,i).then(u(`Adding Storybook support to your "Mithril" app
`));case"MARIONETTE":return lt(o,r,i).then(u(`Adding Storybook support to your "Marionette.js" app
`));case"MARKO":return dt(o,r,i).then(u(`Adding Storybook support to your "Marko" app
`));case"HTML":return mt(o,r,i).then(u(`Adding Storybook support to your "HTML" app
`));case"WEB_COMPONENTS":return ut(o,r,i).then(u(`Adding Storybook support to your "web components" app
`));case"RIOT":return gt(o,r,i).then(u(`Adding Storybook support to your "riot.js" app
`));case"PREACT":return ft(o,r,i).then(u(`Adding Storybook support to your "Preact" app
`));case"SVELTE":return bt(o,r,i).then(u(`Adding Storybook support to your "Svelte" app
`));case"RAX":return kt(o,r,i).then(u(`Adding Storybook support to your "Rax" app
`));case"AURELIA":return Zo(o,r,i).then(u(`Adding Storybook support to your "Aurelia" app
`));case"SERVER":return ht(o,r,i).then(u(`Adding Storybook support to your "Server" app
`));case"UNSUPPORTED":return S("We detected a project type that we don't support yet."),S("If you'd like your framework to be supported, please let use know about it at https://github.com/storybookjs/storybook/issues"),v.log(),Promise.resolve();default:return S(`We couldn't detect your project type. (code: ${e})`),S("You can specify a project type explicitly via `sb init --type <type>`, see our docs on how to configure Storybook for your framework: https://storybook.js.org/docs/react/get-started/install"),v.log(),fs(t,o)}})().catch(c=>{v.error(`
     ${me.red(c.stack)}`),process.exit(1)})},fs=async(e,o)=>{let t=e.yes?!0:await so([{type:"confirm",name:"manual",message:"Do you want to manually choose a Storybook project type to install?"}]);if(t!==!0&&t.manual){let r=await so([{type:"select",name:"manualFramework",message:"Please choose a project type from the following list:",choices:ve.map(n=>({title:n,value:n.toUpperCase()}))}]);return Gt(r.manualFramework,o,e)}return Promise.resolve()};async function Mt(e,o){let t=A.getPackageManager(e.useNpm),r="storybook init - the simplest way to add a Storybook to your project.";v.log(me.inverse(`
 ${r} 
`)),e.disableTelemetry||gs("init"),new us({pkg:o,updateCheckInterval:1e3*60*60}).notify();let n,s=e.type,i=s?`Installing Storybook for user specified project type: ${s}`:"Detecting project type",a=u(i),c=t.retrievePackageJson(),l=c&&c.type==="module";try{s?ve.includes(s)?n=Ue(c,e.force)?"ALREADY_HAS_STORYBOOK":s.toUpperCase():(a(`The provided project type was not recognized by Storybook: ${s}`),v.log(`
The project types currently supported by Storybook are:
`),ve.sort().forEach(d=>S(`- ${d}`)),v.log(),process.exit(1)):n=Fo(c,e)}catch(d){a(d.message),process.exit(1)}if(a(),await Gt(n,t,{...e,...l?{commonJs:!0}:void 0}),e.skipInstall||t.installDependencies(),await ae({yes:e.yes||p.CI==="true"}),v.log(`
To run your Storybook, type:
`),Pe([t.getRunStorybookCommand()]),v.log(`
For more information visit:`,me.cyan("https://storybook.js.org")),n==="REACT_NATIVE"){let d="https://github.com/storybookjs/react-native";v.log(),v.log(me.red("NOTE: installation is not 100% automated.")),v.log(`To quickly run Storybook, replace contents of your app entry with:
`),Pe(["export {default} from './storybook';"]),v.log(`
 For more in information, see the github readme:
`),v.log(me.cyan(d)),v.log()}v.log()}import Lt from"path";import Ie from"fs";import{sync as ys}from"cross-spawn";var io=console,Wt="@storybook/addon-",Yt=async(e,o)=>{try{return await e.latestVersion(o),!0}catch{return!1}},bs=async(e,o)=>Yt(e,`${Wt}${o}`),Ht=(e,o)=>o?Wt+e:e,Ut=e=>e.devDependencies[Object.keys(e.devDependencies).find(o=>/@storybook/.test(o))]||!1,ks=(e,o,t)=>{if(o){let r=e.split("@")[0];return Ut(t)?`${r}@${Ut(t)}`:e}return e},hs=(e,o,t)=>{u(`Preparing to install the ${o} Storybook addon`)(),io.log();let n=ks(o,t,e.retrievePackageJson());io.log();let s=u(`Installing the ${o} Storybook addon`);try{e.addDependencies({},[n])}catch{s(`Something went wrong installing the addon: "${Ht(o,t)}"`),io.log(),process.exit(1)}s()};var ws=["addons","config","presets"],vs=async(e,o)=>{let t=null;o?Ie.existsSync(".storybook")?(t="no codmods found",ws.forEach(r=>{try{let n=U.resolve(`${Ht(e,o)}/postinstall/${r}.js`);u(`Running postinstall script for ${e}`)();let s=Lt.join(".storybook",`${r}.ts`);Ie.existsSync(s)||(s=Lt.join(".storybook",`${r}.js`),Ie.existsSync(s)||Ie.writeFileSync(s,"","utf8")),ys("npx",["jscodeshift","-t",n,s],{stdio:"inherit",shell:!0}),t=null}catch{}})):t="no .storybook config":t="unofficial addon",t&&u(`Skipping postinstall for ${e}, ${t}`)()};async function Kt(e,o){let t=A.getPackageManager(o.useNpm),r=u(`Verifying that ${e} is an addon`),n=await bs(t,e);if(!n&&!await Yt(t,e)){r(`The provided package was not a Storybook addon: ${e}.`);return}r(),hs(t,e,n),o.skipPostinstall||await vs(e,n)}import{listCodemods as xs,runCodemod as Ps}from"@storybook/codemod";async function qt(e,{configDir:o,glob:t,dryRun:r,list:n,rename:s,logger:i,parser:a}){if(n)xs().forEach(c=>i.log(c));else if(e)await Ps(e,{configDir:o,glob:t,dryRun:r,logger:i,rename:s,parser:a});else throw new Error("Migrate: please specify a migration name or --list")}import Zt from"path";import{writeFile as Ss,stat as Cs}from"fs-extra";import Xt from"puppeteer-core";import zt from"express";import Rs from"get-port";import{logger as Qt}from"@storybook/node-logger";var Ds=async e=>{let o=await Es(),t=await o.newPage();await t.goto(e),await t.waitForFunction(`
    (window.__STORYBOOK_PREVIEW__ && window.__STORYBOOK_PREVIEW__.extract && window.__STORYBOOK_PREVIEW__.extract()) ||
    (window.__STORYBOOK_STORY_STORE__ && window.__STORYBOOK_STORY_STORE__.extract && window.__STORYBOOK_STORY_STORE__.extract())
  `);let r=JSON.parse(await t.evaluate(async()=>JSON.stringify(window.__STORYBOOK_STORY_STORE__.getStoriesJsonData(),null,2)));return setImmediate(()=>{o.close()}),r},js=async e=>{if(await Cs(Zt.resolve(e)),e.match(/^http/))return[e,async()=>{}];let o=zt();o.use(zt.static(e));let t=await Rs();return new Promise(r=>{let n=o.listen(t,()=>{let s=`http://localhost:${t}/iframe.html`;Qt.info(`connecting to: ${s}`),r([s,n.close.bind(n)])})})},Es=async()=>{let e=["--no-sandbox ","--disable-setuid-sandbox"];try{return await Xt.launch({args:e,executablePath:p.SB_CHROMIUM_PATH})}catch{return Qt.info("installing puppeteer..."),new Promise((t,r)=>{U("child_process").exec(`node ${U.resolve(Zt.join("puppeteer-core","install.js"))}`,n=>n?r(n):t(Xt.launch({args:e})))})}};async function er(e,o){if(e&&o){let[t,r]=await js(e),n=await Ds(t);await Ss(o,JSON.stringify(n,null,2)),await r()}else throw new Error("Extract: please specify a path where your built-storybook is (can be a public url) and a target directory")}import{sync as tr}from"cross-spawn";import{telemetry as As}from"@storybook/telemetry";import ue from"@storybook/semver";import{logger as B}from"@storybook/node-logger";var Ts=/(@storybook\/[^@]+)@(\S+)/,Os=e=>{if(e.startsWith("npm "))return null;let o=Ts.exec(e);return!o||!ue.clean(o[2])?null:{package:o[1],version:o[2]}},$s=["@storybook/linter-config","@storybook/design-system","@storybook/ember-cli-storybook","@storybook/semver","@storybook/eslint-config-storybook","@storybook/bench","@storybook/addon-bench","@storybook/addon-console","@storybook/csf","@storybook/storybook-deployer","@storybook/addon-postcss","@storybook/react-docgen-typescript-plugin","@storybook/babel-plugin-require-context-hook","@storybook/builder-vite","@storybook/mdx1-csf","@storybook/mdx2-csf","@storybook/expect","@storybook/jest","@storybook/test-runner","@storybook/testing-library"],Fs=e=>e.startsWith("@storybook/")&&!e.startsWith("@storybook/preset-")&&!$s.includes(e),Js=[{minVersion:"6.0.0-alpha.0",url:"https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#60-deprecations",deprecations:["@storybook/addon-notes","@storybook/addon-info","@storybook/addon-contexts","@storybook/addon-options","@storybook/addon-centered"]}],rr=e=>`${e.package}@${e.version}`,or=e=>e.forEach(o=>B.warn(`- ${rr(o)}`)),Is=()=>{let o=tr("npm",["ls"],{stdio:"pipe",shell:!0}).output.toString().split(`
`).map(Os).filter(Boolean).filter(n=>Fs(n.package));if(!o.length){B.warn("No storybook core packages found."),B.warn("'npm ls | grep storybook' can show if multiple versions are installed.");return}o.sort((n,s)=>ue.rcompare(n.version,s.version));let t=o[0].version,r=o.filter(n=>n.version!==t);r.length>0&&(B.warn(`Found ${r.length} outdated packages (relative to '${rr(o[0])}')`),B.warn("Please make sure your packages are updated to ensure a consistent experience."),or(r)),Js.forEach(({minVersion:n,url:s,deprecations:i})=>{if(ue.gte(t,n)){let a=o.filter(c=>i.includes(c.package));a.length>0&&(B.warn(`Found ${a.length} deprecated packages since ${n}`),B.warn(`See ${s}`),or(a))}})},_s={"react-scripts@<5":["--reject","/preset-create-react-app/"]},Vs=(e,o,{dependencies:t,devDependencies:r})=>Object.entries(e).reduce((n,s)=>{let[i,a]=s,[c,l]=q(i),d=t[c]||r[c];return d&&ue.satisfies(ue.coerce(d),l)?[...n,...a]:n},[...o]),nr=async({prerelease:e,skipCheck:o,useNpm:t,dryRun:r,yes:n,...s})=>{let i=A.getPackageManager(t);u("Checking for latest versions of '@storybook/*' packages"),s.disableTelemetry||As("upgrade",{prerelease:e});let a=[];r||a.push("--upgrade"),a.push("--target"),a.push(e?"greatest":"latest"),a=Vs(_s,a,i.retrievePackageJson());let c=tr("npx",["npm-check-updates@latest","/storybook/",...a],{stdio:"pipe",shell:!0}).output.toString();B.info(c),r||(u("Installing upgrades"),i.installDependencies()),o||(Is(),await ae({dryRun:r,yes:n}))};import mo from"prompts";import yi from"fs";import cr from"path";import fe from"chalk";import pr from"boxen";import{dedent as lr}from"ts-dedent";import C from"path";import{readJSON as sr,writeJSON as lo,outputFile as ti}from"fs-extra";import ir from"shelljs";import ri from"chalk";import{command as ni}from"execa";var _e={};Ar(_e,{angular:()=>Hs,angular12:()=>Ls,angular13:()=>Ws,angular130:()=>Us,angular_modern_inline_rendering:()=>Ys,cra:()=>ao,cra_typescript:()=>co,html:()=>Zs,preact:()=>Qs,react:()=>Ns,react_in_yarn_workspace:()=>Ms,react_legacy_root_api:()=>Bs,react_typescript:()=>Gs,sfcVue:()=>ei,svelte:()=>oi,vue:()=>Xs,vue3:()=>zs,web_components:()=>po,web_components_lit2:()=>qs,web_components_typescript:()=>Ks});var z=(...e)=>["mkdir {{appName}}","cd {{appName}}","touch yarn.lock","yarn init --yes",e.length&&`yarn add ${e.join(" ")}`].filter(Boolean).join(" && "),ao={renderer:"react",name:"cra",version:"latest",generator:["npm_config_user_agent=npm npx -p create-react-app@{{version}} create-react-app {{appName}}","cd {{appName}}",'echo "FAST_REFRESH=true" > .env','echo "SKIP_PREFLIGHT_CHECK=true" > .env'].join(" && ")},co={renderer:"react",name:"cra_typescript",version:"latest",generator:["npm_config_user_agent=npm npx -p create-react-app@{{version}} create-react-app {{appName}} --template typescript"].join(" && ")},Ns={renderer:"react",name:"react",version:"latest",generator:z("react","react-dom","@babel/preset-react"),additionalDeps:["prop-types"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-react"] }'}]},Bs={renderer:"react",name:"react_legacy_root_api",version:"latest",generator:z("react","react-dom"),additionalDeps:["prop-types","@babel/preset-react"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-react"] }'}],mainOverrides:{reactOptions:{legacyRootApi:!0}}},Gs={renderer:"react",name:"react_typescript",version:"latest",generator:z("react","react-dom"),typescript:!0,additionalDeps:["@babel/preset-react","@babel/preset-typescript"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-react", "@babel/preset-typescript"] }'}]},Ms={renderer:"react",name:"react_in_yarn_workspace",version:"latest",generator:["mkdir {{appName}}","cd {{appName}}",'echo "{ \\"name\\": \\"workspace-root\\", \\"private\\": true, \\"workspaces\\": [] }" > package.json',"touch yarn.lock","yarn add react react-dom"].join(" && ")},ge={renderer:"angular",name:"angular",version:"latest",generator:"npx -p @angular/cli@{{version}} ng new {{appName}} --routing=true --minimal=true --style=scss --skip-install=true --strict"},Ls={...ge,name:"angular12",version:"v12-lts"},Us={...ge,name:"angular130",version:"13.0.x"},Ws={...ge,name:"angular13",version:"13.1.x"},Ys={...ge,name:"angular_modern_inline_rendering",additionalDeps:["jest@27","@storybook/test-runner"],mainOverrides:{features:{storyStoreV7:!0}}},Hs=ge,po={renderer:"web-components",name:"web_components",version:"2",generator:z("lit-element")},Ks={...po,name:"web_components_typescript",typescript:!0,additionalDeps:["@babel/preset-typescript"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-typescript"] }'}]},qs={...po,version:"next",name:"web_components_lit2",generator:z("lit"),typescript:!0,additionalDeps:["@babel/preset-typescript"],additionalFiles:[{path:".babelrc",contents:'{ "presets": ["@babel/preset-typescript"] }'}]},Xs={renderer:"vue",name:"vue",version:"4",generator:["npx -p @vue/cli@{{version}} vue create {{appName}} --default --packageManager=npm --no-git --force"].join(" && ")},zs={renderer:"vue3",name:"vue3",version:"next",generator:["npx -p @vue/cli@^4 vue create {{appName}} --preset=__default_vue_3__ --packageManager=npm --no-git --force"].join(" && ")},Zs={renderer:"html",name:"html",version:"latest",generator:z(),autoDetect:!1},Qs={renderer:"preact",name:"preact",version:"latest",generator:"npx preact-cli@{{version}} create preactjs-templates/default {{appName}} --install=false --git=false"},ei={renderer:"vue",name:"sfcVue",version:"latest",generator:z("vue@2.6","vue-loader@15.9","vue-template-compiler@2.6","webpack")},oi={renderer:"svelte",name:"svelte",version:"latest",generator:"npx degit sveltejs/template {{appName}}"};var P=console,w=async(e,o={},{startMessage:t,errorMessage:r,dryRun:n}={})=>{if(t&&P.info(t),n){P.info(`
> ${e}
`);return}return P.debug(e),new Promise((s,i)=>{let a={silent:!1},c=ir.exec(e,{...a,...o,async:!0,silent:!1});c.stderr.pipe(process.stderr),c.on("exit",l=>{l===0?s(void 0):(P.error(ri.red(`An error occurred while executing: \`${e}\``)),P.log(r),i(new Error(`command exited with code: ${l}: `)))})})},si=async({cwd:e})=>{P.info("\u{1F522} Adding package resolutions:");let o=C.join(e,"package.json"),t=await sr(o);t.resolutions=D,await lo(o,t,{spaces:2})},ii=async({cwd:e})=>{P.info("\u{1F522} Adding package resolutions:");let o=C.join(e,"package.json"),t=await sr(o),r=C.join(__dirname,"..","..","..","..",".."),{stdout:n}=await ni("yarn workspaces list --json",{cwd:r});console.log({stdout:n,workspaceDir:r});let s=JSON.parse(`[${n.split(`
`).join(",")}]`);console.log({workspaces:s}),t.resolutions=Object.keys(D).reduce((i,a)=>({...i,[a]:C.join(r,s.find(c=>c.name===a).location)}),{}),await lo(o,t,{spaces:2})},ai=async({cwd:e,pnp:o,name:t})=>{let r=["yarn set version berry","yarn config set enableGlobalCache true",`yarn config set nodeLinker ${o?"pnp":"node-modules"}`];[ao.name,co.name].includes(t)&&r.push(`yarn config set packageExtensions --json '{ "babel-preset-react-app@10.0.x": { "dependencies": { "@babel/plugin-proposal-private-property-in-object": "^7.16.0" } } }'`),await w(r.join(" && "),{cwd:e},{startMessage:"\u{1F9F6} Installing Yarn 2",errorMessage:"\u{1F6A8} Installing Yarn 2 failed"})},ci=async({cwd:e})=>{let o=[`yarn config set npmScopes --json '{ "storybook": { "npmRegistryServer": "http://localhost:6001/" } }'`,`yarn config set unsafeHttpWhitelist --json '["localhost"]'`,"yarn config set pnpFallbackMode none","yarn config set enableImmutableInstalls false",`yarn config set logFilters --json '[ { "code": "YN0013", "level": "discard" } ]'`].join(" && ");await w(o,{cwd:e},{startMessage:"\u{1F39B} Configuring Yarn 2",errorMessage:"\u{1F6A8} Configuring Yarn 2 failed"})},pi=async({cwd:e,name:o,appName:t,version:r,generator:n})=>{let s=n.replace(/{{appName}}/g,t).replace(/{{version}}/g,r);await w(s,{cwd:e},{startMessage:`\u{1F3D7} Bootstrapping ${o} project (this might take a few minutes)`,errorMessage:`\u{1F6A8} Bootstrapping ${o} failed`})},li=async({additionalFiles:e,cwd:o})=>{P.info("\u2935\uFE0F Adding required files"),await Promise.all(e.map(async t=>{await ti(C.resolve(o,t.path),t.contents,{encoding:"UTF-8"})}))},di=async({cwd:e,autoDetect:o=!0,name:t,e2e:r,pnp:n})=>{let s=["--yes"];o||s.push(`--type ${t}`),r&&s.push("--linkable"),n&&s.push("--use-pnp");let a=`${`node ${__filename}`} init ${s.join(" ")}`;await w(a,{cwd:e},{startMessage:"\u{1F3A8} Initializing Storybook with @storybook/cli",errorMessage:"\u{1F6A8} Storybook initialization failed"})},mi=async({cwd:e,additionalDeps:o})=>{ir.rm("-f",C.join(e,"package-lock.json"),C.join(e,"yarn.lock"));let t=o&&o.length>0?`yarn add -D ${o.join(" ")}`:"yarn install";await w(t,{cwd:e},{startMessage:"\u{1F30D} Adding needed deps & installing all deps",errorMessage:"\u{1F6A8} Dependencies installation failed"})},ui=async({cwd:e})=>{P.info("\u{1F46E} Adding typescript and tsconfig.json");try{await w("yarn add -D typescript@latest",{cwd:e});let o={compilerOptions:{baseUrl:".",esModuleInterop:!0,jsx:"preserve",skipLibCheck:!0,strict:!0},include:["src/*"]},t=C.resolve(e,"tsconfig.json");await lo(t,o,{encoding:"utf8",spaces:2})}catch(o){throw P.error("\u{1F6A8} Creating tsconfig.json failed"),o}},F=async(e,o,t=!0)=>{t&&(await e(o),P.log())},gi=e=>w(`npm ${["config","set","registry",e].join(" ")}`,{cwd:C.join(process.cwd(),"..")}),fi=e=>w(`yarn ${["config","set","npmRegistryServer",e].join(" ")}`,{cwd:C.join(__dirname,"..")}),ar=async(e,{name:o,version:t,...r},{e2e:n,pnp:s,local:i,registry:a})=>{let c={name:o,version:t,appName:C.basename(e),creationPath:C.join(e,".."),cwd:e,e2e:n,pnp:s,...r};P.log(),P.info(`\u{1F3C3} Starting for ${o} ${t}`),P.log(),await F(pi,{...c,cwd:c.creationPath}),await F(li,{...c,cwd:e},!!c.additionalFiles),n&&await F(si,c),i&&await F(ii,c),await F(ai,c),n&&await F(ci,c,n),await F(ui,c,!!c.typescript),await F(mi,c),a&&(await gi(a),await fi(a)),await F(di,c)};var G=console,bi=_e,ki=Object.fromEntries(Object.entries(_e).filter(e=>e[0]!=="react_in_yarn_workspace")),uo=Object.values(ki).reduce((e,o)=>(e[o.renderer]=[...e[o.renderer]||[],o],e),{}),dr=async({outputDirectory:e,list:o,template:t,renderer:r,generator:n,e2e:s,local:i,registry:a,pnp:c})=>{if(G.info(pr(lr`
        ðŸ¤— Welcome to ${fe.yellow("sb repro")}! ðŸ¤— 

        Create a ${fe.green("new project")} to minimally reproduce Storybook issues.
        
        1. select an environment that most closely matches your project setup.
        2. select a location for the reproduction, outside of your project.
        
        After the reproduction is ready, we'll guide you through the next steps.
        `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"})),o){G.info("\u{1F308} Available templates"),Object.entries(uo).forEach(([f,h])=>{G.info(f),h.forEach(ee=>G.info(`- ${ee.name}`)),f==="other"&&G.info("- blank")});return}let l=t,d=r;if(!l&&!n){if(!d){let{renderer:f}=await mo({type:"select",message:"\u{1F308} Select the repro renderer",name:"renderer",choices:Object.keys(uo).map(h=>({title:h,value:h}))});d=f}if(!d)throw new Error("\u{1F6A8} Repro: please select a renderer!");l=(await mo({type:"select",message:"\u{1F4DD} Select the repro base template",name:"template",choices:uo[d].map(f=>({title:f.name,value:f.name}))})).template}let g=n?{name:"custom",version:"custom",generator:n}:bi[l];if(!g)throw new Error("\u{1F6A8} Repro: please specify a valid template type");let k=e;if(!k){let{directory:f}=await mo({type:"text",message:"Enter the output directory",name:"directory",initial:g.name,validate:h=>yi.existsSync(h)?`${h} already exists. Please choose another name.`:!0});k=f}try{let f=cr.isAbsolute(k)?k:cr.join(process.cwd(),k);G.info(`\u{1F3C3} Running ${l} into ${f}`),await ar(f,g,{registry:a,e2e:!!s,pnp:!!c,local:!!i}),s||await hi(f),G.info(pr(lr`
        ðŸŽ‰ Your Storybook reproduction project is ready to use! ðŸŽ‰

        ${fe.yellow(`cd ${k}`)}
        ${fe.yellow("yarn storybook")}

        Once you've recreated the problem you're experiencing, please:
        
        1. Document any additional steps in ${fe.cyan("README.md")}
        2. Publish the repository to github
        3. Link to the repro repository in your issue

        Having a clean repro helps us solve your issue faster! ðŸ™
      `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"}))}catch(f){throw G.error("\u{1F6A8} Failed to create repro"),f}},hi=async e=>{await w("git init",{cwd:e}),await w('echo "node_modules" >> .gitignore',{cwd:e}),await w("git add --all",{cwd:e}),await w('git commit -am "added storybook"',{cwd:e}),await w("git tag repro-base",{cwd:e})};import gr from"prompts";import mr from"path";import M from"chalk";import go from"boxen";import{dedent as fo}from"ts-dedent";import Si from"degit";import{existsSync as ur}from"fs-extra";var wi={"cra/default-js":{name:"Create React App (Javascript)",script:"npx create-react-app .",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/cra",renderer:"@storybook/react",builder:"@storybook/builder-webpack5"}},"cra/default-ts":{name:"Create React App (Typescript)",script:"npx create-react-app . --template typescript",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/cra",renderer:"@storybook/react",builder:"@storybook/builder-webpack5"}}},vi={"react-vite/default-js":{name:"React Vite (JS)",script:"yarn create vite . --template react",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/react-vite",renderer:"@storybook/react",builder:"@storybook/builder-vite"}},"react-vite/default-ts":{name:"React Vite (TS)",script:"yarn create vite . --template react-ts",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/react-vite",renderer:"@storybook/react",builder:"@storybook/builder-vite"}}},xi={"vue3-vite/default-js":{name:"Vue3 Vite (JS)",script:"yarn create vite . --template vue",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/vue3-vite",renderer:"@storybook/vue3",builder:"@storybook/builder-vite"}},"vue3-vite/default-ts":{name:"Vue3 Vite (TS)",script:"yarn create vite . --template vue-ts",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/vue3-vite",renderer:"@storybook/vue3",builder:"@storybook/builder-vite"}}},Pi={"svelte-vite/default-js":{name:"Svelte Vite (JS)",script:"yarn create vite . --template svelte",cadence:["ci","daily","weekly"],expected:{framework:"@storybook/svelte-vite",renderer:"@storybook/svelte",builder:"@storybook/builder-vite"}}},ye={...wi,...vi,...xi,...Pi};var J=console,Ci=e=>({title:ye[e].name,value:e}),fr=async({output:e,filterValue:o,branch:t,init:r})=>{let n=Object.keys(ye),s=n.reduce((g,k)=>{let f=ye[k],h=new RegExp(o,"i");return(!o||f.name.match(h)||k.match(h)||f.expected.builder.match(h)||f.expected.framework.match(h)||f.expected.renderer.match(h))&&g.push(k),g},[]);s.length===0&&(J.info(go(fo`
          ðŸ”Ž You filtered out all templates. ðŸ”
          
          After filtering all the templates with "${M.yellow(o)}", we found no results. Please try again with a different filter.

          Available templates:
          ${n.map(g=>M.blue`- ${g}`).join(`
`)}
          `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"})),process.exit(1));let i=null;if(s.length===1?[i]=s:(J.info(go(fo`
          ðŸ¤— Welcome to ${M.yellow("sb repro NEXT")}! ðŸ¤— 
  
          Create a ${M.green("new project")} to minimally reproduce Storybook issues.
          
          1. select an environment that most closely matches your project setup.
          2. select a location for the reproduction, outside of your project.
          
          After the reproduction is ready, we'll guide you through the next steps.
          `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"})),i=await Ri(s)),!!!(i??null)){J.error("Somehow we got no templates. Please rerun this command!");return}let c=ye[i];if(!c)throw new Error("\u{1F6A8} Repro: please specify a valid template type");let l=e,d=e||i;if(l&&ur(`${l}`)&&J.info(`\u26A0\uFE0F  ${l} already exists! Overwriting...`),!l){let{directory:g}=await gr({type:"text",message:"Enter the output directory",name:"directory",initial:d,validate:async k=>ur(k)?`${k} already exists. Please choose another name.`:!0});l=g}try{let g=mr.isAbsolute(l)?l:mr.join(process.cwd(),l);J.info(`\u{1F3C3} Adding ${c.name} into ${g}`),J.log("\u{1F4E6} Downloading repro template...");try{await Si(`storybookjs/repro-templates-temp/${i}/${r?"after-storybook":"before-storybook"}#${t}`,{force:!0}).clone(g)}catch(f){throw J.error(`\u{1F6A8} Failed to download repro template: ${f.message}`),f}let k=r?M.yellow("yarn storybook"):`Recreate your setup, then ${M.yellow("run npx storybook init")}`;J.info(go(fo`
        ðŸŽ‰ Your Storybook reproduction project is ready to use! ðŸŽ‰

        ${M.yellow(`cd ${l}`)}
        ${k}

        Once you've recreated the problem you're experiencing, please:
        
        1. Document any additional steps in ${M.cyan("README.md")}
        2. Publish the repository to github
        3. Link to the repro repository in your issue

        Having a clean repro helps us solve your issue faster! ðŸ™
      `.trim(),{borderStyle:"round",padding:1,borderColor:"#F1618C"}))}catch(g){throw J.error("\u{1F6A8} Failed to create repro"),g}};async function Ri(e){let{template:o}=await gr({type:"select",message:"\u{1F308} Select the template",name:"template",choices:e.map(Ci)});return o||null}import yr from"fs-extra";import be from"path";import{sync as Di}from"cross-spawn";import{logger as O}from"@storybook/node-logger";var br=async({target:e,local:o,start:t})=>{let r=process.cwd();try{if(JSON.parse(yr.readFileSync("package.json","utf8")).name!=="@storybook/root")throw new Error}catch{throw new Error("Expected to run link from the root of the storybook monorepo")}let n=e,s=be.basename(e);if(!o){let a=be.join(r,"../storybook-repros");O.info(`Ensuring directory ${a}`),yr.ensureDirSync(a),O.info(`Cloning ${e}`),await w(`git clone ${e}`,{cwd:a}),s=be.basename(e,be.extname(e)),n=be.join(a,s)}let i=Di("yarn",["--version"],{cwd:n,stdio:"pipe",shell:!0}).stdout.toString();if(!/^[23]\./.test(i)){O.warn(`\u{1F6A8} Expected yarn 2 or 3 in ${n}!`),O.warn(""),O.warn("Please set it up with `yarn set version berry`,"),O.warn(`then link '${n}' with the '--local' flag.`);return}O.info(`Linking ${n}`),await w(`yarn link --all ${r}`,{cwd:n}),O.info(`Installing ${s}`),await w("yarn install",{cwd:n}),O.info("Magic stuff related to @storybook/preset-create-react-app, we need to fix peerDependencies"),await w("yarn add -D webpack-hot-middleware",{cwd:n}),t&&(O.info(`Running ${s} storybook`),await w("yarn run storybook",{cwd:n}))};import{dedent as kr}from"ts-dedent";import{sync as ji}from"read-pkg-up";import{logger as Z,instance as Ei}from"@storybook/node-logger";import{buildDevStandalone as Ai}from"@storybook/core-server";import{cache as Ti}from"@storybook/core-common";var hr=async e=>{"production"="production";try{await Ai({...e,configDir:e.configDir||"./.storybook",configType:"DEVELOPMENT",ignorePreview:!!e.previewUrl&&!e.forceBuildPreview,docsMode:!!e.docs,cache:Ti,packageJson:ji({cwd:__dirname}).packageJson})}catch(o){Ei.heading="",o instanceof Error?o.error?Z.error(o.error):o.stats&&o.stats.compilation.errors?o.stats.compilation.errors.forEach(t=>Z.plain(t)):Z.error(o):o.compilation?.errors&&o.compilation.errors.forEach(t=>Z.plain(t)),Z.line(),Z.warn(o.close?kr`
          FATAL broken build!, will close the process,
          Fix the error below and restart storybook.
        `:kr`
          Broken build, fix the error above.
          You may need to refresh the browser.
        `),Z.line(),process.exit(1)}};import{sync as Oi}from"read-pkg-up";import{logger as $i}from"@storybook/node-logger";import{buildStaticStandalone as Fi}from"@storybook/core-server";import{cache as Ji}from"@storybook/core-common";var wr=async e=>{try{await Fi({...e,configDir:e.configDir||"./.storybook",outputDir:e.outputDir||"./storybook-static",ignorePreview:!!e.previewUrl&&!e.forceBuildPreview,docsMode:!!e.docs,configType:"PRODUCTION",cache:Ji,packageJson:Oi({cwd:__dirname}).packageJson})}catch(o){$i.error(o),process.exit(1)}};function Ve(e){return e.split(",").map(o=>o.trim()).filter(o=>o.length>0)}function yo(e,o){Object.keys(o).forEach(t=>{let r=o[t],n=p[r];n&&(e[t]=n)})}var L=Ni({cwd:__dirname}).packageJson,Q=console;b.option("--disable-telemetry","disable sending telemetry data",p.STORYBOOK_DISABLE_TELEMETRY&&p.STORYBOOK_DISABLE_TELEMETRY!=="false");b.option("--enable-crash-reports","enable sending crash reports to telemetry data");b.command("init").description("Initialize Storybook into your project.").option("-f --force","Force add Storybook").option("-s --skip-install","Skip installing deps").option("-N --use-npm","Use npm to install deps").option("--use-pnp","Enable pnp mode").option("-p --parser <babel | babylon | flow | ts | tsx>","jscodeshift parser").option("-t --type <type>","Add Storybook for a specific project type").option("-y --yes","Answer yes to all prompts").option("-b --builder <builder>","Builder library").option("-l --linkable","Prepare installation for link (contributor helper)").action(e=>Mt(e,L).catch(o=>{I.error(o),process.exit(1)}));b.command("add <addon>").description("Add an addon to your Storybook").option("-N --use-npm","Use NPM to build the Storybook server").option("-s --skip-postinstall","Skip package specific postinstall config modifications").action((e,o)=>Kt(e,o));b.command("babelrc").description("generate the default storybook babel config into your current working directory").action(()=>Ae());b.command("upgrade").description("Upgrade your Storybook packages to the latest").option("-N --use-npm","Use NPM to build the Storybook server").option("-y --yes","Skip prompting the user").option("-n --dry-run","Only check for upgrades, do not install").option("-p --prerelease","Upgrade to the pre-release packages").option("-s --skip-check","Skip postinstall version and automigration checks").action(e=>nr(e));b.command("info").description("Prints debugging information about the local environment").action(()=>{Q.log(Ne.bold(`
Environment Info:`)),_i.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Edge","Firefox","Safari"],npmPackages:"@storybook/*",npmGlobalPackages:"@storybook/*"}).then(Q.log)});b.command("migrate [migration]").description("Run a Storybook codemod migration on your source files").option("-l --list","List available migrations").option("-g --glob <glob>","Glob for files upon which to apply the migration","**/*.js").option("-p --parser <babel | babylon | flow | ts | tsx>","jscodeshift parser").option("-n --dry-run","Dry run: verify the migration exists and show the files to which it will be applied").option("-r --rename <from-to>",'Rename suffix of matching files after codemod has been applied, e.g. ".js:.ts"').action((e,{configDir:o,glob:t,dryRun:r,list:n,rename:s,parser:i})=>{qt(e,{configDir:o,glob:t,dryRun:r,list:n,rename:s,parser:i,logger:Q}).catch(a=>{I.error(a),process.exit(1)})});b.command("extract [location] [output]").description("extract stories.json from a built version").action((e="storybook-static",o=Ii.join(e,"stories.json"))=>er(e,o).catch(t=>{I.error(t),process.exit(1)}));b.command("repro [outputDirectory]").description("Create a reproduction from a set of possible templates").option("-f --renderer <renderer>","Filter on given renderer").option("-t --template <template>","Use the given template").option("-l --list","List available templates").option("-g --generator <generator>","Use custom generator command").option("--registry <registry>","which registry to use for storybook packages").option("--pnp","Use Yarn Plug'n'Play mode instead of node_modules one").option("--local","use storybook's local packages instead of yarn's registry").option("--e2e","Used in e2e context").action((e,{renderer:o,template:t,list:r,e2e:n,generator:s,pnp:i,local:a})=>dr({outputDirectory:e,renderer:o,template:t,list:r,e2e:n,local:a,generator:s,pnp:i}).catch(c=>{I.error(c),process.exit(1)}));b.command("repro-next [filterValue]").description("Create a reproduction from a set of possible templates").option("-o --output <outDir>","Define an output directory").option("-b --branch <branch>","Define the branch to degit from","next").option("--no-init","Whether to download a template without an initialized Storybook",!1).action((e,o)=>fr({filterValue:e,...o}).catch(t=>{I.error(t),process.exit(1)}));b.command("link <repo-url-or-directory>").description("Pull down a repro from a URL (or a local directory), link it, and run storybook").option("--local","Link a local directory already in your file system").option("--no-start","Start the storybook",!0).action((e,{local:o,start:t})=>br({target:e,local:o,start:t}).catch(r=>{I.error(r),process.exit(1)}));b.command("automigrate [fixId]").description("Check storybook for known problems or migrations and apply fixes").option("-y --yes","Skip prompting the user").option("-n --dry-run","Only check for fixes, do not actually run them").action((e,o)=>ae({fixId:e,...o}).catch(t=>{I.error(t),process.exit(1)}));b.command("dev").option("-p, --port <number>","Port to run Storybook",e=>parseInt(e,10)).option("-h, --host <string>","Host to run Storybook").option("-s, --static-dir <dir-names>","Directory where to load static files from",Ve).option("-c, --config-dir <dir-name>","Directory where to load Storybook configurations from").option("--https","Serve Storybook over HTTPS. Note: You must provide your own certificate information.").option("--ssl-ca <ca>","Provide an SSL certificate authority. (Optional with --https, required if using a self-signed certificate)",Ve).option("--ssl-cert <cert>","Provide an SSL certificate. (Required with --https)").option("--ssl-key <key>","Provide an SSL key. (Required with --https)").option("--smoke-test","Exit after successful start").option("--ci","CI mode (skip interactive prompts, don't open browser)").option("--no-open","Do not open Storybook automatically in the browser").option("--loglevel <level>","Control level of logging during build").option("--quiet","Suppress verbose build output").option("--no-version-updates","Suppress update check",!0).option("--no-release-notes","Suppress automatic redirects to the release notes after upgrading",!0).option("--no-manager-cache","Do not cache the manager UI").option("--debug-webpack","Display final webpack configurations for debugging purposes").option("--webpack-stats-json [directory]","Write Webpack Stats JSON to disk").option("--preview-url <string>","Disables the default storybook preview and lets your use your own").option("--force-build-preview","Build the preview iframe even if you are using --preview-url").option("--docs","Build a documentation-only site using addon-docs").action(e=>{I.setLevel(b.loglevel),Q.log(Ne.bold(`${L.name} v${L.version}`)+Ne.reset(`
`)),yo(b,{port:"SBCONFIG_PORT",host:"SBCONFIG_HOSTNAME",staticDir:"SBCONFIG_STATIC_DIR",configDir:"SBCONFIG_CONFIG_DIR",ci:"CI"}),typeof b.port=="string"&&b.port.length>0&&(b.port=parseInt(b.port,10)),hr({...e,packageJson:L})});b.command("build").option("-s, --static-dir <dir-names>","Directory where to load static files from",Ve).option("-o, --output-dir <dir-name>","Directory where to store built files").option("-c, --config-dir <dir-name>","Directory where to load Storybook configurations from").option("--quiet","Suppress verbose build output").option("--loglevel <level>","Control level of logging during build").option("--debug-webpack","Display final webpack configurations for debugging purposes").option("--webpack-stats-json [directory]","Write Webpack Stats JSON to disk").option("--preview-url <string>","Disables the default storybook preview and lets your use your own").option("--force-build-preview","Build the preview iframe even if you are using --preview-url").option("--docs","Build a documentation-only site using addon-docs").option("--no-manager-cache","Do not cache the manager UI").action(e=>{"production"="production",I.setLevel(b.loglevel),Q.log(Ne.bold(`${L.name} v${L.version}
`)),yo(b,{staticDir:"SBCONFIG_STATIC_DIR",outputDir:"SBCONFIG_OUTPUT_DIR",configDir:"SBCONFIG_CONFIG_DIR"}),wr({...e,packageJson:L})});b.on("command:*",([e])=>{Q.error(` Invalid command: %s.
 See --help for a list of available commands.`,e);let t=b.commands.map(r=>r._name).find(r=>Vi(r,e)<3);t&&Q.info(`
 Did you mean ${t}?`),process.exit(1)});b.usage("<command> [options]").version(L.version).parse(process.argv);
