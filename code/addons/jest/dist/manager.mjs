import{a as I,b as N,c as L,d as _}from"./chunk-UQBOECPL.mjs";import*as J from"react";import{addons as j}from"@storybook/addons";import o,{Fragment as Y}from"react";import{styled as c,themes as h,convert as y}from"@storybook/theming";import{ScrollArea as ft,TabsState as Tt,Link as Pt,Placeholder as f}from"@storybook/components";import{SizeMe as ht}from"react-sizeme";import p,{Fragment as B,useState as ot}from"react";import{styled as O,themes as nt,convert as rt}from"@storybook/theming";import{Icons as it}from"@storybook/components";import u,{Fragment as U}from"react";import{styled as k}from"@storybook/theming";var K=/\[32m(.*?)\[39m/,X=/\[31m(.*?)\[39m/,A="positive",q="negative",C="[39m",M="[31m",F="[32m",Q="at",E=":",b=class{},V=k.pre(({theme:t})=>({background:t.color.lighter,paddingTop:4,paddingBottom:4,paddingLeft:6,borderRadius:2,overflow:"auto",margin:"10px 30px 10px 30px",whiteSpace:"pre"})),Z=k.div({paddingTop:10,marginLeft:31,marginRight:30}),R=k.div(({theme:t})=>({paddingBottom:10,paddingTop:10,borderBottom:t.appBorderColor,marginLeft:31,marginRight:30,overflowWrap:"break-word"})),tt=k.strong(({status:t,theme:e})=>({color:t===A?e.color.positive:e.color.negative,fontWeight:500})),w=(t,e)=>e?t.split(e===A?K:X).map((n,r)=>r%2?u.createElement(tt,{key:`${e}_${n}`,status:e},n):n):[t],v=t=>{let e=[];return t&&t.split(/\[2m/).join("").split(/\[22m/).forEach(r=>{r&&r.trim()&&(r.indexOf(M)>-1&&r.indexOf(M)<r.indexOf(C)?e=e.concat(w(r,q)):r.indexOf(F)>-1&&r.indexOf(F)<r.indexOf(C)?e=e.concat(w(r,A)):e=e.concat(r))}),e},et=t=>{let e=t.split(`
`).filter(Boolean),n=new b;n.description=v(e[0]),n.stackTrace="",n.result=[];for(let r=1;r<e.length;r+=1){let s=e[r],g=e[r+1];if(s.trim().toLowerCase().indexOf(Q)===0)n.stackTrace+=`${s.trim()}
`;else if(s.trim().indexOf(E)>-1){let d,a=null;s.trim().indexOf(E)===s.length-1?(d=s.trim(),a=v(g),r+=1):(d=s.substring(0,s.indexOf(E)).trim(),a=v(s.substring(s.indexOf(E),s.length))),n.result=[...n.result,d," ",...a,u.createElement("br",{key:r})]}else n.result=[...n.result," ",...v(s)]}return n},st=t=>{let{msg:e}=t,n=et(e);return u.createElement(U,null,n.description?u.createElement(R,null,n.description):null,n.result?u.createElement(Z,null,n.result):null,n.stackTrace?u.createElement(V,null,n.stackTrace):null)},$=st;var lt=O.div(({theme:t,status:e})=>({display:"flex",width:"100%",borderTop:`1px solid ${t.appBorderColor}`,"&:hover":{background:e==="failed"?t.background.hoverable:null}})),at=O.div(({theme:t,status:e})=>({padding:t.layoutMargin,paddingLeft:t.layoutMargin-3,background:"none",color:"inherit",textAlign:"left",cursor:e==="failed"?"pointer":null,borderLeft:"3px solid transparent",width:"100%",display:"flex","&:focus":{outline:"0 none",borderLeft:`3px solid ${t.color.secondary}`}})),dt=O(it)(({theme:t})=>({height:10,width:10,minWidth:10,color:t.color.mediumdark,marginRight:10,transition:"transform 0.1s ease-in-out",alignSelf:"center",display:"inline-flex"})),H=t=>t.charAt(0).toUpperCase().concat(t.slice(1));function gt(t){let[e,n]=ot(!1),r=()=>{n(!e)},{fullName:s,title:g,failureMessages:d,status:a}=t;return p.createElement(B,null,p.createElement(lt,{status:a},p.createElement(at,{onClick:r,role:"button",status:a},a==="failed"?p.createElement(dt,{icon:"arrowdown",color:rt(nt.light).color.mediumdark,style:{transform:`rotate(${e?0:-90}deg)`}}):null,p.createElement("div",null,H(s)||H(g)))),e?p.createElement(B,null,d.map((m,l)=>p.createElement($,{msg:m,key:l}))):null)}var T=gt;import pt,{Component as ct}from"react";import{STORY_CHANGED as mt}from"@storybook/core-events";var ut=t=>{var e;return e=class extends ct{constructor(){super(...arguments);this.state={};this.onAddTests=({kind:s,storyName:g,tests:d})=>{this.setState({kind:s,storyName:g,tests:d})}}componentDidMount(){this.mounted=!0;let{api:s}=this.props;this.stopListeningOnStory=s.on(mt,()=>{let{kind:g,storyName:d,tests:a}=this.state;this.mounted&&(g||d||a)&&this.onAddTests({})}),s.on(_,this.onAddTests)}componentWillUnmount(){this.mounted=!1;let{api:s}=this.props;this.stopListeningOnStory(),s.off(_,this.onAddTests)}render(){let{active:s}=this.props,{tests:g}=this.state;return s?pt.createElement(t,{tests:g}):null}},e.defaultProps={active:!1},e},G=ut;var i={PASSED_TYPE:"passed",FAILED_TYPE:"failed",PENDING_TYPE:"pending",TODO_TYPE:"todo"},D=c.ul({listStyle:"none",fontSize:14,padding:0,margin:0}),x=c.li({display:"block",padding:0}),yt=c.div({position:"relative",height:10,width:30,display:"flex",top:-2}),Et=c.div({display:"flex",alignItems:"baseline",position:"absolute",zIndex:2,right:20,marginTop:15}),vt=({result:t,className:e,width:n})=>o.createElement("div",{className:e},o.createElement(Y,null,n>325&&t.assertionResults?o.createElement("div",null,t.assertionResults.length," ",t.assertionResults.length>1?"tests":"test"):null,n>280&&t.endTime&&t.startTime?o.createElement("div",null,t.endTime-t.startTime,"ms"):null)),St=c(vt)(({theme:t})=>({display:"flex",alignItems:"center",color:t.color.dark,fontSize:"14px",marginTop:-5,"& > *":{marginRight:10}})),kt=c.div(({color:t,progressPercent:e})=>({height:6,top:3,width:`${e}%`,backgroundColor:t})),Dt=t=>{let e=new Map;return t.assertionResults.forEach(n=>{e.set(n.status,e.get(n.status)?e.get(n.status).concat(n):[n])}),e},P=t=>{switch(t){case i.PASSED_TYPE:return y(h.light).color.positive;case i.FAILED_TYPE:return y(h.light).color.negative;case i.PENDING_TYPE:return y(h.light).color.warning;case i.TODO_TYPE:return y(h.light).color.purple;default:return null}},xt=c(({tests:t,className:e})=>o.createElement("div",{className:e},t.map(({name:n,result:r})=>{if(!r||!r.assertionResults)return o.createElement(f,{key:n},"This story has tests configured, but no file was found");let s=Dt(r),d=[...s.entries()].sort((a,m)=>a[1].length-m[1].length);return o.createElement(ht,{refreshMode:"debounce",key:n},({size:a})=>{let{width:m}=a;return o.createElement("section",null,o.createElement(Et,null,o.createElement(St,{...{result:r,width:m}}),m>240?o.createElement(yt,null,d.map(l=>o.createElement(kt,{key:`progress-portion-${l[0]}`,color:P(l[0]),progressPercent:l[1]?l[1].length/r.assertionResults.length*100:0}))):null),o.createElement(Tt,{initial:"failing-tests",backgroundColor:y(h.light).background.hoverable},o.createElement("div",{id:"failing-tests",title:`${s.get(i.FAILED_TYPE)?s.get(i.FAILED_TYPE).length:0} Failed`,color:P(i.FAILED_TYPE)},o.createElement(D,null,s.get(i.FAILED_TYPE)?s.get(i.FAILED_TYPE).map(l=>o.createElement(x,{key:l.fullName||l.title},o.createElement(T,{...l}))):o.createElement(f,{key:`no-tests-${i.FAILED_TYPE}`},"This story has no failing tests."))),o.createElement("div",{id:"passing-tests",title:`${s.get(i.PASSED_TYPE)?s.get(i.PASSED_TYPE).length:0} Passed`,color:P(i.PASSED_TYPE)},o.createElement(D,null,s.get(i.PASSED_TYPE)?s.get(i.PASSED_TYPE).map(l=>o.createElement(x,{key:l.fullName||l.title},o.createElement(T,{...l}))):o.createElement(f,{key:`no-tests-${i.PASSED_TYPE}`},"This story has no passing tests."))),o.createElement("div",{id:"pending-tests",title:`${s.get(i.PENDING_TYPE)?s.get(i.PENDING_TYPE).length:0} Pending`,color:P(i.PENDING_TYPE)},o.createElement(D,null,s.get(i.PENDING_TYPE)?s.get(i.PENDING_TYPE).map(l=>o.createElement(x,{key:l.fullName||l.title},o.createElement(T,{...l}))):o.createElement(f,{key:`no-tests-${i.PENDING_TYPE}`},"This story has no pending tests."))),o.createElement("div",{id:"todo-tests",title:`${s.get(i.TODO_TYPE)?s.get(i.TODO_TYPE).length:0} Todo`,color:P(i.TODO_TYPE)},o.createElement(D,null,s.get(i.TODO_TYPE)?s.get(i.TODO_TYPE).map(l=>o.createElement(x,{key:l.fullName||l.title},o.createElement(T,{...l}))):o.createElement(f,{key:`no-tests-${i.TODO_TYPE}`},"This story has no tests todo.")))))})})))({flex:"1 1 0%"}),z=({tests:t})=>o.createElement(ft,{vertical:!0},t?o.createElement(xt,{tests:t}):o.createElement(f,null,o.createElement(Y,null,"No tests found"),o.createElement(Y,null,"Learn how to\xA0",o.createElement(Pt,{href:"https://github.com/storybookjs/storybook/tree/master/addons/jest",target:"_blank",withArrow:!0},"add Jest test results to your story"))));z.defaultProps={tests:null};var W=G(z);j.register(N,t=>{j.addPanel(L,{title:"Tests",render:({active:e,key:n})=>J.createElement(W,{key:n,api:t,active:e}),paramKey:I})});
