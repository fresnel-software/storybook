var p=Object.create;var i=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var g=(s,e)=>{for(var t in e)i(s,t,{get:e[t],enumerable:!0})},h=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of v(e))!f.call(s,r)&&r!==t&&i(s,r,{get:()=>e[r],enumerable:!(n=c(e,r))||n.enumerable});return s};var y=(s,e,t)=>(t=s!=null?p(L(s)):{},h(e||!s||!s.__esModule?i(t,"default",{value:s,enumerable:!0}):t,s)),u=s=>h(i({},"__esModule",{value:!0}),s);var m={};g(m,{Channel:()=>a,default:()=>E});module.exports=u(m);var l=y(require("util-deprecate")),d=require("ts-dedent"),C=()=>Math.random().toString(16).slice(2),a=class{constructor({transport:e,async:t=!1}={}){this.sender=C();this.events={};this.data={};this.addPeerListener=(0,l.default)((e,t)=>{this.addListener(e,t)},d.dedent`
      channel.addPeerListener is deprecated
    `);this.isAsync=t,e&&(this.transport=e,this.transport.setHandler(n=>this.handleEvent(n)))}get hasTransport(){return!!this.transport}addListener(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}emit(e,...t){let n={type:e,args:t,from:this.sender},r={};t.length>=1&&t[0]&&t[0].options&&(r=t[0].options);let o=()=>{this.transport&&this.transport.send(n,r),this.handleEvent(n)};this.isAsync?setImmediate(o):o()}last(e){return this.data[e]}eventNames(){return Object.keys(this.events)}listenerCount(e){let t=this.listeners(e);return t?t.length:0}listeners(e){return this.events[e]||void 0}once(e,t){let n=this.onceListener(e,t);this.addListener(e,n)}removeAllListeners(e){e?this.events[e]&&delete this.events[e]:this.events={}}removeListener(e,t){let n=this.listeners(e);n&&(this.events[e]=n.filter(r=>r!==t))}on(e,t){this.addListener(e,t)}off(e,t){this.removeListener(e,t)}handleEvent(e){let t=this.listeners(e.type);t&&t.length&&t.forEach(n=>{n.apply(e,e.args)}),this.data[e.type]=e.args}onceListener(e,t){let n=(...r)=>(this.removeListener(e,n),t(...r));return n}},E=a;0&&(module.exports={Channel});
