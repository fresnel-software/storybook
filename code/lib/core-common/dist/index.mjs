var u=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(r,t)=>(typeof require!="undefined"?require:r)[t]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var a={};import{dedent as ve}from"ts-dedent";import{logger as P}from"@storybook/node-logger";import{dirname as Pe}from"path";import A from"path";import K from"fs";var T=new Set([".js",".jsx",".ts",".tsx",".cjs",".mjs"]);function ge(){return[...Array.from(T)]}var U=ge();function y(e){return U.map(r=>e.endsWith(r)?e:`${e}${r}`).find(r=>K.existsSync(r))}function V(e){return U.map(r=>({path:e.endsWith(r)?e:`${e}${r}`,ext:r})).find(r=>K.existsSync(r.path))}var q=!1;function $(e){if(q===!1){let{register:o}=u("esbuild-register/dist/node");q=!0,o({target:`node${process.version.slice(1)}`,format:"cjs",hookIgnoreNodeModules:!1,tsconfigRaw:`{
      "compilerOptions": {
        "strict": false,
        "skipLibCheck": true,
      },
    }`})}let r=u(e);return typeof r=="object"&&r!==null&&typeof r.default<"u"?r.default:r}function ue(e){for(let r=0;r<e.length;r+=1){let t=V(e[r]);if(t)return t}}function h(e){let r=j(e);return r?$(r):null}function j(e){let r=Array.isArray(e)?e:[e],t=ue(r);return t?t.path:null}import{dedent as w}from"ts-dedent";import ye from"util-deprecate";import be from"glob";import v from"path";var xe=ye(()=>{},w`
    Configuration files such as "config", "presets" and "addons" are deprecated and will be removed in Storybook 7.0.
    Read more about it in the migration guide: https://github.com/storybookjs/storybook/blob/master/MIGRATION.md#to-mainjs-configuration
  `),I=(e,r,t)=>{let o=v.resolve(t,e),n=v.resolve(t,r);throw new Error(w`
    You have mixing configuration files:
    ${o}
    ${n}
    "${e}" and "${r}" cannot coexist.
    Please check the documentation for migration steps: https://github.com/storybookjs/storybook/blob/master/MIGRATION.md#to-mainjs-configuration
  `)};function S(e){let r=`{${Array.from(T).join(",")}}`,t=s=>!!be.sync(v.resolve(e,`${s}${r}`)).length,o=t("main"),n=t("config");if(!o&&!n)throw new Error(w`
      No configuration files have been found in your configDir (${v.resolve(e)}).
      Storybook needs either a "main" or "config" file.
    `);if(o&&n)throw new Error(w`
      You have both a "main" and a "config". Please remove the "config" file from your configDir (${v.resolve(e,"config")})`);let i=t("presets");o&&i&&I("main","presets",e),t("preview")&&n&&I("preview","config",e);let c=t("addons");t("manager")&&c&&I("manager","addons",e),(i||n||c)&&xe()}function H({configDir:e}){S(e);let r=h(A.resolve(e,"presets"));if(h(A.resolve(e,"main"))){let o=j(A.resolve(e,"main"));if(o)return[o]}return r||[]}import he from"resolve-from";var W=(e,r)=>{try{return he(e,r)}catch{return}},z=e=>{try{return u.resolve(e)}catch{return}};var k=e=>e!=null&&typeof e=="object"&&Array.isArray(e)===!1,ke=e=>typeof e=="function";function Oe(e){return e.filter(r=>{let t=typeof r=="string"?r:r.name;return!/@storybook[\\\\/]preset-typescript/.test(t)})}function Y(e,r,t){return ke(e)?[...e({...t,...r})]:Array.isArray(e)?[...e]:[]}var we=(e,r,t)=>{let o=r.startsWith("/")?z:W.bind(null,e),n=o(r);if(n){if(r.match(/\/(manager|register(-panel)?)(\.(js|ts|tsx|jsx))?$/))return{type:"virtual",name:r,managerEntries:[n]};if(r.match(/\/(preset)(\.(js|ts|tsx|jsx))?$/))return{type:"presets",name:n}}let i=n&&o(`${r}/package.json`),p=i&&Pe(i),c=g=>{if(o(`${r}${g}`))return`${p}${g}`},l=r,s=c("/manager"),f=c("/register")||c("/register-panel"),d=c("/preview"),m=o(`${l}/preset`);if(!(s||d)&&m)return{type:"presets",name:m};if(s||f||d||m){let g=[];return s&&g.push(s),!s&&f&&!m&&g.push(f),{type:"virtual",name:l,...g.length?{managerEntries:g}:{},...d?{previewAnnotations:[d]}:{},...m?{presets:[{name:m,options:t}]}:{}}}if(n)return{type:"presets",name:n}},Se=({configDir:e})=>r=>{let t=k(r)&&r.options||void 0,o=k(r)?r.name:r;try{let n=we(e,o,t);return{...t?{options:t}:{},...n}}catch{P.error(`Addon value should end in /manager or /preview or /register OR it should be a valid preset https://storybook.js.org/docs/react/addons/writing-presets/
${r}`)}};async function Ce(e){if(e.type==="virtual"){let{type:t,name:o,...n}=e;return n}let r=e.name?e.name:e;return $(r)}async function Re(e,r,t){try{let o=e.name?e.name:e,n=e.options?e.options:{},i=await Ce(e);if(typeof i=="function"&&(i=i(t,n)),Array.isArray(i))return C(i,r+1,t);if(k(i)){let{addons:p,presets:c,...l}=i,s=Y(c,n,t),f=Y(p,n,t);return[...await C([...s],r+1,t),...await C([...f.map(Se(t))].filter(Boolean),r+1,t),{name:o,preset:l,options:n}]}throw new Error(ve`
      ${e} is not a valid preset
    `)}catch(o){let n=r>0?`  Failed to load preset: ${JSON.stringify(e)} on level ${r}`:`  Failed to load preset: ${JSON.stringify(e)}`;return P.warn(n),P.error(o),[]}}async function C(e,r,t){return!e||!Array.isArray(e)||!e.length?[]:(r||P.info("=> Loading presets"),(await Promise.all(e.map(async o=>Re(o,r,t)))).reduce((o,n)=>o.concat(n),[]))}function G(e,r,t,o,n){let i=new Promise(p=>p(t));return e.length?e.reduce((p,{preset:c,options:l})=>{let s=c[r];if(!s)return p;if(typeof s=="function"){let f=s,d={preset:c,combinedOptions:{...n,...o,...l,presetsList:e,presets:{apply:async(m,g,x={})=>G(e,m,g,x,n)}}};return p.then(m=>f.call(d.preset,m,d.combinedOptions))}return p.then(f=>Array.isArray(f)&&Array.isArray(s)?[...f,...s]:k(f)&&k(s)?{...f,...s}:s)},i):i}async function Ee(e,r){let t=await C(e,0,r);return{apply:async(o,n,i={})=>G(t,o,n,i,r)}}async function _r(e){let{corePresets:r=[],overridePresets:t=[],...o}=e,n=[...r,...H(e),...t],i=Oe(n);return i.length<n.length&&P.warn("Storybook now supports TypeScript natively. You can safely remove `@storybook/preset-typescript`."),Ee(i,o)}var{logger:N}=u("@storybook/node-logger"),D=e=>r=>{let t=r.name||r;return t&&t.includes(e)},Te=(e,r,t)=>{let o=e.findIndex(D("@storybook/addon-essentials")),n=e.findIndex(D(r.name)),i=e.findIndex(D(t.name));return n===-1&&r.inEssentials&&(n=o),i===-1&&t.inEssentials&&(i=o),n!==-1&&i!==-1&&n<=i},Mr=async({before:e,after:r,configFile:t,getConfig:o})=>{try{let n=await o(t);if(!n?.addons){N.warn("Unable to find 'addons' config in main Storybook config");return}if(!Te(n.addons,e,r)){let i=" (or '@storybook/addon-essentials')",p=`'${e.name}'${e.inEssentials?i:""}`,c=`'${r.name}'${r.inEssentials?i:""}`;N.warn(`Expected ${p} to be listed before ${c} in main Storybook config.`)}}catch{N.warn(`Unable to load config file: ${t}`)}};import{getEnvironment as je}from"lazy-universal-dotenv";import R from"path";import X from"find-up";var Vr=()=>{let e;try{let r=X.sync(".git",{type:"directory"});r&&(e=e||R.join(r,".."))}catch{}try{let r=X.sync(".svn",{type:"directory"});r&&(e=e||R.join(r,".."))}catch{}try{e=e||__dirname.split("node_modules")[0]}catch{}return e||process.cwd()},Z=e=>e.split(process.platform==="win32"?";":":").filter(Boolean).map(r=>R.resolve("./",r)),$e=/^\.{1,2}([/\\]|$)/;function Q(e){return $e.test(e)?e:`.${R.sep}${e}`}function zr(e={}){let r=e.production?"production":"development",t={NODE_ENV:"production",NODE_PATH:a.NODE_PATH||"",STORYBOOK:a.STORYBOOK||"true",PUBLIC_URL:e.production?".":""};Object.keys(a).filter(c=>/^STORYBOOK_/.test(c)).forEach(c=>{t[c]=a[c]});let o=Object.entries(t).reduce((c,[l,s])=>Object.assign(c,{[l]:JSON.stringify(s)}),{}),{stringified:n,raw:i}=je({nodeEnv:t.NODE_ENV}),p={...t,...i};return p.NODE_PATH=Z(p.NODE_PATH||""),{stringified:{...o,...n},raw:p}}var Yr=e=>Object.entries(e).reduce((r,[t,o])=>(r[t]=JSON.stringify(o),r),{}),Gr=e=>Object.entries(e).reduce((t,[o,n])=>(t[`process.env.${o}`]=JSON.stringify(n),t),{"process.env.XSTORYBOOK_EXAMPLE_APP":'""'});import Ie from"handlebars";function Qr(e,r){return Ie.compile(e)(r)}import Ae from"path";function nt({configDir:e}){return S(e),h(Ae.resolve(e,"main"))}import{dedent as Ne}from"ts-dedent";async function at(e){let r=await e.presets.apply("framework","",e);if(!r)throw new Error(Ne`
      You must specify a framework in '.storybook/main.js' config.

      https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#framework-field-mandatory
    `);return typeof r=="object"?r.name:r}function ee(e,r,t){if(!e)return null;let o=e.split(/[\s='"]+/),n=o.indexOf(t);return n===-1&&(n=o.indexOf(r)),n===-1?null:o[n+1]}import De from"path";import Fe from"fs-extra";var re={"@storybook/react":"react","@storybook/vue":"vue","@storybook/vue3":"vue3","@storybook/angular":"angular","@storybook/html":"html","@storybook/web-components":"web-components","@storybook/polymer":"polymer","@storybook/ember":"ember","@storybook/marko":"marko","@storybook/mithril":"mithril","@storybook/riot":"riot","@storybook/svelte":"svelte","@storybook/preact":"preact","@storybook/rax":"rax","@storybook/server":"server"},te=console,Le=({dependencies:e,devDependencies:r,peerDependencies:t},o)=>[Object.entries(e||{}).find(o),Object.entries(r||{}).find(o),Object.entries(t||{}).find(o)],_e=e=>{let[r,t,o]=Le(e,([c])=>re[c]),[n,i]=r||t||o||[],p=n?re[n]:void 0;return r&&t&&r[0]===t[0]&&te.warn(`Found "${r[0]}" in both "dependencies" and "devDependencies". This is probably a mistake.`),r&&o&&r[0]===o[0]&&te.warn(`Found "${r[0]}" in both "dependencies" and "peerDependencies". This is probably a mistake.`),{version:i,framework:p,frameworkPackage:n,renderer:p,rendererPackage:n}},Be=["ts","js","tsx","jsx","mjs","cjs"],F=(e,r)=>{let t=De.join(r,e),o=Be.find(n=>Fe.existsSync(`${t}.${n}`));return o?`${t}.${o}`:null},Me=e=>{let r=".storybook",t=e.scripts?.storybook;if(t){let o=ee(t,"-c","--config-dir");o&&(r=o)}return{configDir:r,mainConfig:F("main",r),previewConfig:F("preview",r),managerConfig:F("manager",r)}},mt=e=>{let r=_e(e),t=Me(e);return{...r,...t}};import{readJSON as oe}from"fs-extra";import{dirname as Je,join as Ke}from"path";import Ue from"find-up";import Ve from"resolve-from";import{logger as qe}from"@storybook/node-logger";var He=async e=>{let r=await Ue("package.json",{cwd:e.configDir});if(!r)return{};let t=Je(r),{dependencies:o=[],devDependencies:n=[]}=await oe(r)||{},i=Object.keys({...o,...n});return(await Promise.all(i.map(async c=>{try{let l=Ve(t,Ke(c,"package.json")),{storybook:s,name:f,version:d}=await oe(l)||{};if(s?.url)return{id:f,...s,version:d}}catch{qe.warn(`unable to find package.json for ${c}`);return}}))).filter(Boolean).reduce((c,l)=>({...c,[l.id]:{id:l.id.toLowerCase(),url:ne(l.url),title:l.title,version:l.version}}),{})},We=e=>fetch(`${e}/iframe.html`).then(async({ok:r,status:t})=>{if(r){if(t!==200)return!1;let o=await fetch(`${e}/iframe.html`,{headers:{Accept:"application/json"}});if(o.ok&&(await o.json().catch(n=>({}))).loginUrl)return!1}return r},()=>!1),ne=e=>e.replace(/\/$/,""),ze=e=>{let r=e.replace(/[A-Z]/g,t=>` ${t}`).replace(/[-_][A-Z]/gi,t=>` ${t.toUpperCase()}`).replace(/-/g," ").replace(/_/g," ");return`${r.substring(0,1).toUpperCase()}${r.substring(1)}`.trim()};async function vt(e){let r=await e.presets.apply("refs",await He(e));return Object.entries(r).forEach(([t,o])=>{if(o.disable){delete r[t];return}r[t.toLowerCase()]={...o,id:t.toLowerCase(),title:o.title||ze(o.id||t),url:ne(o.url)}}),await Promise.all(Object.entries(r).map(async([t,o])=>{let n=await We(o.url);r[t]={...o,type:n?"server-checked":"unknown"}})),r}import L from"path";import{logger as Ye}from"@storybook/node-logger";import{dedent as Ge}from"ts-dedent";function Ct({configDir:e}){let r=y(L.resolve(e,"addons")),t=y(L.resolve(e,"manager"));if((r||t)&&Ye.info("=> Loading custom manager config"),r&&t)throw new Error(Ge`
      You have both a "addons.js" and a "manager.js", remove the "addons.js" file from your configDir (${L.resolve(e,"addons")})`);return t||r}import _ from"path";import{dedent as Xe}from"ts-dedent";function jt({configDir:e}){let r=y(_.resolve(e,"config")),t=y(_.resolve(e,"preview"));if(r&&t)throw new Error(Xe`
      You have both a "config.js" and a "preview.js", remove the "config.js" file from your configDir (${_.resolve(e,"config")})`);return t||r}import Ze from"chalk";function Nt(e,r){console.log(Ze.cyan(e)),console.dir(r,{depth:null})}import Qe from"pretty-hrtime";var se=e=>Qe(process.hrtime(e)).replace(" ms"," milliseconds").replace(" s"," seconds").replace(" m"," minutes");var Bt=async(e,r,t)=>{let o=0,n,i=()=>{};e.get("/progress",(l,s)=>{let f=!1,d=()=>{f=!0,s.end()};s.on("close",d),!(f||s.writableEnded)&&(s.setHeader("Cache-Control","no-cache"),s.setHeader("Content-Type","text/event-stream"),s.setHeader("Connection","keep-alive"),s.flushHeaders(),i=m=>{f||s.writableEnded||(s.write(`data: ${JSON.stringify(m)}

`),s.flush(),m.value===1&&d())})});let p=(l,s,f)=>{o=Math.max(l,o);let d={value:o,message:s.charAt(0).toUpperCase()+s.slice(1)};if(s==="building"){let m=f&&f.match(/(\d+)\/(\d+)/)||[],g=parseInt(m[1],10),x=parseInt(m[2],10);!Number.isNaN(g)&&!Number.isNaN(x)&&(d.modules={complete:g,total:x},n=x)}o===1&&(t.cache&&t.cache.set("modulesCount",n),d.message||(d.message=`Completed in ${se(r)}.`)),i(d)},c=await t.cache?.get("modulesCount").catch(()=>{})||1e3;return{handler:p,modulesCount:c}};import B from"path";import er from"pkg-dir";function ie(e){let r=process.cwd(),t=er.sync(r),o;return t?o=B.resolve(t,"node_modules/.cache/storybook"):o=B.resolve(r,".cache/storybook"),B.join(o,e)}import rr from"file-system-cache";function M(e){return rr(e)}var zt=M({basePath:ie("dev-server"),ns:"storybook"});import ae from"path";import{sync as J}from"pkg-dir";import b from"fs";var ce=(e,r={})=>Object.entries(r).reduce((t,[o,n])=>t.replace(new RegExp(`%${o}%`,"g"),n),e);function Qt(e,r){let t=b.readFileSync(`${J(__dirname)}/templates/base-preview-body.html`,"utf8"),o=ae.resolve(e,"preview-body.html"),n=t;return b.existsSync(o)&&(n=b.readFileSync(o,"utf8")+n),ce(n,r)}function eo(e,r){let t=b.readFileSync(`${J(__dirname)}/templates/base-preview-head.html`,"utf8"),o=ae.resolve(e,"preview-head.html"),n=t;return b.existsSync(o)&&(n+=b.readFileSync(o,"utf8")),ce(n,r)}function ro(){return`${J(__dirname)}/templates/preview.ejs`}var oo=(e,r)=>Object.entries(r).reduce((t,[o,n])=>{let i=n.replace(/\\/g,"/").replace(/\$/g,"$$$");return t.replace(new RegExp(`{{${o}}}`,"g"),i)},e);import{makeRe as tr}from"picomatch";function pe(e){let r=tr(e,{fastpaths:!1,noglobstar:!1,bash:!1});if(!r.source.startsWith("^"))throw new Error(`Invalid glob: >> ${e} >> ${r}`);return e.startsWith("./")?new RegExp(["^\\.",e.startsWith("./**")?"":"[\\\\/]",r.source.substring(1)].join("")):r}import or from"fs";import O from"path";import nr from"util-deprecate";import{dedent as sr}from"ts-dedent";import{scan as ir}from"picomatch";import fe from"slash";var E="",le="**/*.@(mdx|stories.mdx|stories.tsx|stories.ts|stories.jsx|stories.js)",ar=nr(e=>e.input.replace(e[1],`@${e[1]}`),sr`
    You have specified an invalid glob, we've attempted to fix it, please ensure that the glob you specify is valid. See: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#correct-globs-in-mainjs
  `),cr=e=>{let r=e.match(/\.(\([^)]+\))/);return r?ar(r):e},pr=(e,r)=>{try{return or.lstatSync(O.resolve(e,r)).isDirectory()}catch{return!1}},fr=({configDir:e,workingDir:r,directory:t})=>{let o=O.resolve(e,t),n=O.relative(r,o);return Q(n)},lr=(e,{configDir:r,workingDir:t})=>{let o;if(typeof e=="string"){let l=cr(e),s=ir(l);if(s.isGlob){let f=s.prefix+s.base,d=s.glob;o={titlePrefix:E,directory:f,files:d}}else pr(r,e)?o={titlePrefix:E,directory:e,files:le}:o={titlePrefix:E,directory:O.dirname(e),files:O.basename(e)}}else o={titlePrefix:E,files:le,...e};let n=fe(o.files),{directory:i}=o,p=fe(fr({configDir:r,workingDir:t,directory:i})).replace(/\/$/,""),c=pe(`${p}/${n}`);return{...o,directory:p,importPathMatcher:c}},yo=(e,r)=>e.map(t=>lr(t,r));import dr from"fs-extra";async function ho(e){return dr.readFile(e,{encoding:"utf8"})}import de from"path";import{sync as mr}from"find-up";var Oo=(e,r)=>{let t=mr("package.json",{cwd:e});if(!t)throw new Error(`Could not find package.json in: ${e}`);let o=de.dirname(t);return de.join(o,"dist","esm",r)};function So(){let{NODE_OPTIONS:e,NODE_PRESERVE_SYMLINKS:r}=a;return!!r||e?.includes("--preserve-symlinks")}export{T as boost,zt as cache,Mr as checkAddonOrder,M as createFileSystemCache,Oe as filterPresetsConfig,Oo as findDistEsm,He as getAutoRefs,fr as getDirectoryFromWorkingDir,at as getFrameworkName,y as getInterpretedFile,V as getInterpretedFileWithExt,Ee as getPresets,Qt as getPreviewBodyTemplate,eo as getPreviewHeadTemplate,ro as getPreviewMainTemplate,Vr as getProjectRoot,vt as getRefs,ee as getStorybookConfiguration,mt as getStorybookInfo,pe as globToRegexp,Qr as handlebars,$ as interopRequireDefault,oo as interpolate,So as isPreservingSymlinks,_r as loadAllPresets,H as loadCustomPresets,zr as loadEnvs,nt as loadMainConfig,Ct as loadManagerOrAddonsFile,Re as loadPreset,jt as loadPreviewOrConfigFile,Nt as logConfig,Z as nodePathsToArray,yo as normalizeStories,lr as normalizeStoriesEntry,Q as normalizeStoryPath,ho as readTemplate,we as resolveAddonName,ie as resolvePathInStorybookCache,h as serverRequire,j as serverResolve,Yr as stringifyEnvs,Gr as stringifyProcessEnvs,Bt as useProgressReporting,S as validateConfigurationFiles};
